<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Rspress v1.45.6">
    <title data-rh="true">与 ISO-TP 交互 - RAMN 文档：抗干扰汽车微型网络</title>
  <script>{;const saved = localStorage.getItem('rspress-theme-appearance');const preferDark = window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = !saved || saved === 'auto' ? preferDark : saved === 'dark';document.documentElement.classList.toggle('dark', isDark);document.documentElement.style.colorScheme = isDark ? 'dark' : 'light';}</script><link rel="icon" href="/ramn-cartoon.png"><script defer src="/static/js/styles.197c6af7.js"></script><script defer src="/static/js/lib-react.78f62612.js"></script><script defer src="/static/js/lib-router.eb40978d.js"></script><script defer src="/static/js/162.c1fe1a1e.js"></script><script defer src="/static/js/index.4245ed64.js"></script><link href="/static/css/styles.eb04fe59.css" rel="stylesheet"></head>

  <body >
    <div id="root"><div class="navContainer_d18b1 rspress-nav px-6  sticky_ddfa7"><div class="container_e4235 flex justify-between items-center h-full"><div class="navBarTitle_c5f07"><a href="/index.html" class="link_a7cea flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60"><div class="mr-1 min-w-8"><img src="/ramn-light-logo.png" alt="logo" id="logo" class="rspress-logo dark:hidden"/><img src="/ramn-dark-logo.png" alt="logo" id="logo" class="rspress-logo hidden dark:block"/></div></a></div><div class="flex flex-1 justify-end items-center"><div class="rightNav_a2fea"><div class="flex sm:flex-1 items-center sm:pl-4 sm:pr-2"><div class="rspress-nav-search-button navSearchButton_df1fb"><button><svg width="18" height="18" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9"></path></svg><p class="searchWord_af2c1">Search</p><div style="opacity:0"><span></span><span>K</span></div></button></div><div class="mobileNavSearchButton_d85a9"><svg width="24" height="24" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9"></path></svg></div></div><div class="rspress-nav-menu menu h-14"><a href="/docs/general.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154 activeItem_a28b5 text-sm font-medium mx-1.5 px-3 py-2 flex items-center break-keep">文档</div></a><a href="/case/index.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center break-keep">成品展示</div></a></div><div class="flex-center flex-row"><div class="mx-2"><div class="md:mr-2 rspress-nav-appearance"><div class="p-1 border border-solid border-gray-300 text-gray-400  cursor-pointer rounded-md hover:border-gray-600 hover:text-gray-600 dark:hover:border-gray-200 dark:hover:text-gray-200 transition-all duration-300 w-7 h-7"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="dark:hidden" width="18" height="18" fill="currentColor"><path d="M12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6m0-10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4M12 4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1M12 24c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1M5.6 6.6c-.3 0-.5-.1-.7-.3L3.5 4.9c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.1.2-.4.3-.7.3M19.8 20.8c-.3 0-.5-.1-.7-.3l-1.4-1.4c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.2.2-.5.3-.7.3M3 13H1c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1M23 13h-2c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1M4.2 20.8c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.4.3-.7.3M18.4 6.6c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.5.3-.7.3"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="hidden dark:block" width="18" height="18" fill="currentColor"><path d="M12.1 22h-.9c-5.5-.5-9.5-5.4-9-10.9.4-4.8 4.2-8.6 9-9 .4 0 .8.2 1 .5s.2.8-.1 1.1c-2 2.7-1.4 6.4 1.3 8.4 2.1 1.6 5 1.6 7.1 0 .3-.2.7-.3 1.1-.1.3.2.5.6.5 1-.2 2.7-1.5 5.1-3.6 6.8-1.9 1.4-4.1 2.2-6.4 2.2M9.3 4.4c-2.9 1-5 3.6-5.2 6.8-.4 4.4 2.8 8.3 7.2 8.7 2.1.2 4.2-.4 5.8-1.8 1.1-.9 1.9-2.1 2.4-3.4-2.5.9-5.3.5-7.5-1.1-2.8-2.2-3.9-5.9-2.7-9.2"></path></svg></div></div></div><div class="social-links menu-item_e90a6 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/ToyotaInfoTech/RAMN" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a><a href="https://h4cker.zip/" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364q.204-.03.415-.056q-.207.033-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a9 9 0 0 1-.415-.056q.21.026.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8"/></svg></div></div></a><a href="https://space.bilibili.com/434014419" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M17.813 4.653h.854q2.266.08 3.773 1.574Q23.946 7.72 24 9.987v7.36q-.054 2.266-1.56 3.773c-1.506 1.507-2.262 1.524-3.773 1.56H5.333q-2.266-.054-3.773-1.56C.053 19.614.036 18.858 0 17.347v-7.36q.054-2.267 1.56-3.76t3.773-1.574h.774l-1.174-1.12a1.23 1.23 0 0 1-.373-.906q0-.534.373-.907l.027-.027q.4-.373.92-.373t.92.373L9.653 4.44q.107.106.187.213h4.267a.8.8 0 0 1 .16-.213l2.853-2.747q.4-.373.92-.373c.347 0 .662.151.929.4s.391.551.391.907q0 .532-.373.906zM5.333 7.24q-1.12.027-1.88.773q-.76.748-.786 1.894v7.52q.026 1.146.786 1.893t1.88.773h13.334q1.12-.026 1.88-.773t.786-1.893v-7.52q-.026-1.147-.786-1.894t-1.88-.773zM8 11.107q.56 0 .933.373q.375.374.4.96v1.173q-.025.586-.4.96q-.373.375-.933.374c-.56-.001-.684-.125-.933-.374q-.375-.373-.4-.96V12.44q0-.56.386-.947q.387-.386.947-.386m8 0q.56 0 .933.373q.375.374.4.96v1.173q-.025.586-.4.96q-.373.375-.933.374c-.56-.001-.684-.125-.933-.374q-.375-.373-.4-.96V12.44q.025-.586.4-.96q.373-.373.933-.373"/></svg></div></div></a><div class="social-links-icon_a4ad0 cursor-pointer relative mx-3"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213c0 .163.13.295.29.295a.33.33 0 0 0 .167-.054l1.903-1.114a.86.86 0 0 1 .717-.098a10.2 10.2 0 0 0 2.837.403c.276 0 .543-.027.811-.05c-.857-2.578.157-4.972 1.932-6.446c1.703-1.415 3.882-1.98 5.853-1.838c-.576-3.583-4.196-6.348-8.596-6.348M5.785 5.991c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178A1.17 1.17 0 0 1 4.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178a1.17 1.17 0 0 1-1.162-1.178c0-.651.52-1.18 1.162-1.18m5.34 2.867c-1.797-.052-3.746.512-5.28 1.786c-1.72 1.428-2.687 3.72-1.78 6.22c.942 2.453 3.666 4.229 6.884 4.229c.826 0 1.622-.12 2.361-.336a.72.72 0 0 1 .598.082l1.584.926a.3.3 0 0 0 .14.047c.134 0 .24-.111.24-.247c0-.06-.023-.12-.038-.177l-.327-1.233a.6.6 0 0 1-.023-.156a.49.49 0 0 1 .201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89c-.135-.01-.27-.027-.407-.03zm-2.53 3.274c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983a.976.976 0 0 1-.969-.983c0-.542.434-.982.97-.982zm4.844 0c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983a.976.976 0 0 1-.969-.983c0-.542.434-.982.969-.982"/></svg></div></div></div></div></div></div><div class="mobileNavMenu_e7045"><div class="navScreen_ec30c  rspress-nav-screen" id="navScreen"><div class="container_c935d"><div class="navMenu_b887b"><div class="navMenuItem_e7978 w-full"><a href="/docs/general.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154 activeItem_a28b5 text-sm font-medium mx-1.5 px-3 py-2 flex items-center break-keep">文档</div></a></div><div class="navMenuItem_e7978 w-full"><a href="/case/index.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center break-keep">成品展示</div></a></div></div><div class="flex-center flex-col gap-2"><div class="mt-2 navAppearance_bf893 flex justify-center"></div><div class="social-links menu-item_e90a6 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/ToyotaInfoTech/RAMN" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a><a href="https://h4cker.zip/" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364q.204-.03.415-.056q-.207.033-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a9 9 0 0 1-.415-.056q.21.026.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8"/></svg></div></div></a><a href="https://space.bilibili.com/434014419" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M17.813 4.653h.854q2.266.08 3.773 1.574Q23.946 7.72 24 9.987v7.36q-.054 2.266-1.56 3.773c-1.506 1.507-2.262 1.524-3.773 1.56H5.333q-2.266-.054-3.773-1.56C.053 19.614.036 18.858 0 17.347v-7.36q.054-2.267 1.56-3.76t3.773-1.574h.774l-1.174-1.12a1.23 1.23 0 0 1-.373-.906q0-.534.373-.907l.027-.027q.4-.373.92-.373t.92.373L9.653 4.44q.107.106.187.213h4.267a.8.8 0 0 1 .16-.213l2.853-2.747q.4-.373.92-.373c.347 0 .662.151.929.4s.391.551.391.907q0 .532-.373.906zM5.333 7.24q-1.12.027-1.88.773q-.76.748-.786 1.894v7.52q.026 1.146.786 1.893t1.88.773h13.334q1.12-.026 1.88-.773t.786-1.893v-7.52q-.026-1.147-.786-1.894t-1.88-.773zM8 11.107q.56 0 .933.373q.375.374.4.96v1.173q-.025.586-.4.96q-.373.375-.933.374c-.56-.001-.684-.125-.933-.374q-.375-.373-.4-.96V12.44q0-.56.386-.947q.387-.386.947-.386m8 0q.56 0 .933.373q.375.374.4.96v1.173q-.025.586-.4.96q-.373.375-.933.374c-.56-.001-.684-.125-.933-.374q-.375-.373-.4-.96V12.44q.025-.586.4-.96q.373-.373.933-.373"/></svg></div></div></a><div class="social-links-icon_a4ad0 cursor-pointer relative mx-3"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213c0 .163.13.295.29.295a.33.33 0 0 0 .167-.054l1.903-1.114a.86.86 0 0 1 .717-.098a10.2 10.2 0 0 0 2.837.403c.276 0 .543-.027.811-.05c-.857-2.578.157-4.972 1.932-6.446c1.703-1.415 3.882-1.98 5.853-1.838c-.576-3.583-4.196-6.348-8.596-6.348M5.785 5.991c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178A1.17 1.17 0 0 1 4.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178a1.17 1.17 0 0 1-1.162-1.178c0-.651.52-1.18 1.162-1.18m5.34 2.867c-1.797-.052-3.746.512-5.28 1.786c-1.72 1.428-2.687 3.72-1.78 6.22c.942 2.453 3.666 4.229 6.884 4.229c.826 0 1.622-.12 2.361-.336a.72.72 0 0 1 .598.082l1.584.926a.3.3 0 0 0 .14.047c.134 0 .24-.111.24-.247c0-.06-.023-.12-.038-.177l-.327-1.233a.6.6 0 0 1-.023-.156a.49.49 0 0 1 .201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89c-.135-.01-.27-.027-.407-.03zm-2.53 3.274c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983a.976.976 0 0 1-.969-.983c0-.542.434-.982.97-.982zm4.844 0c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983a.976.976 0 0 1-.969-.983c0-.542.434-.982.969-.982"/></svg></div></div></div></div></div></div></div><button aria-label="mobile hamburger" class=" rspress-mobile-hamburger navHamburger_ac64c text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="currentColor"><circle cx="8" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="24" cy="16" r="2" fill="currentColor"></circle></svg></button></div></div></div></div><section><div class="docLayout_af141 pt-0"><aside class="sidebar_dd719 rspress-sidebar "><div class="navTitleMask_fb17c"><div class="navBarTitle_c5f07"><a href="/index.html" class="link_a7cea flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60"><div class="mr-1 min-w-8"><img src="/ramn-light-logo.png" alt="logo" id="logo" class="rspress-logo dark:hidden"/><img src="/ramn-dark-logo.png" alt="logo" id="logo" class="rspress-logo hidden dark:block"/></div></a></div></div><div class="rspress-scrollbar sidebarContent_da296"><nav class="pb-2"><a href="/docs/general.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>介绍</span></div></a><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">硬件</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/docs/hardware/overview.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>概述</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/expansions.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>扩展端口</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/ordering.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>PCB 订购</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/flashing.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>固件刷写</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/qualitycheck.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>质量检查</span></div></a></div><div class="rspress-sidebar-item"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:18px"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex"><span class="flex-center" style="font-size:13px">原理图详情</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:0"><div class="rspress-sidebar-item"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:18px"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex"><span class="flex-center" style="font-size:13px">ECUs</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:0"><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/ecus/powersupply.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>电源</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/ecus/microcontroller.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>微控制器</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/ecus/canphy.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>CAN-FD 收发器</span></div></a></div></div></div></section></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/canbus.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>CAN/CAN-FD 总线</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/usb.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>USB</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/screens.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>屏幕（网关/信息娱乐）</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/chassis.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>底盘</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/powertrain.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>动力总成</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/body.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>车身</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/debugger.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>调试器</span></div></a></div></div></div></section></div></div></div></section><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">固件</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/docs/firmware/customizing_guide.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>自定义指南</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/firmware/architecture.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>固件架构</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/firmware/memory_layout.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>内存布局</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/firmware/common_issues.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>故障排除</span></div></a></div></div></div></section><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">脚本</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/docs/scripts/install.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>配置 RAMN 的脚本</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/scripts/carla.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>CARLA</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/scripts/vcand.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>vcand</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/scripts/build.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>构建</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/scripts/diagnostics.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>诊断</span></div></a></div></div></div></section><a href="/docs/quickstart.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>快速入门指南</span></div></a><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">用户指南</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/docs/userguide/ramn_introduction.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>简介</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/userguide/can_tutorial.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>与 CAN 交互</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/userguide/isotp_tutorial.html" class="link_a7cea menuLink_bb039"><div class="menuItemActive_de63c mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>与 ISO-TP 交互</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/userguide/diag_tutorial.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>与 UDS 交互</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/userguide/usb_tutorial.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>与 USB 交互</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/userguide/going_further.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>更进一步</span></div></a></div></div></div></section><a href="/docs/minictf.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>CTF训练</span></div></a><a href="/docs/ctf_writeups.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>CTF题解</span></div></a><a href="/docs/translation.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>翻译</span></div></a></nav></div></aside><div class="flex-1 relative min-w-0"><div class="rspress-sidebar-menu-container "><div class="rspress-sidebar-menu"><button type="button" class="flex-center mr-auto"><div class="text-md mr-2"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M4 6h24v2H4zm0 18h24v2H4zm0-12h24v2H4zm0 6h24v2H4z"></path></svg></div><span class="text-sm">Menu</span></button><button type="button" class="flex-center ml-auto"><span class="text-sm">目录</span><div class="text-md mr-2" style="transform:rotate(0deg);transition:transform 0.2s ease-out;margin-top:2px"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></button><div class="rspress-local-toc-container "><ul><li><a href="#iso-tp-基础" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">ISO-TP 基础</span></a></li><li><a href="#单帧" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">单帧</span></a></li><li><a href="#首帧与连续帧" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">首帧与连续帧</span></a></li><li><a href="#流量控制帧" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">流量控制帧</span></a></li><li><a href="#示例" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">示例</span></a></li><li><a href="#linux-上的-iso-tp" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">Linux 上的 ISO-TP</span></a></li><li><a href="#candump" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">candump</span></a></li><li><a href="#cansend" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">cansend</span></a></li><li><a href="#isotpsend" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">isotpsend</span></a></li><li><a href="#isotprecv" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">isotprecv</span></a></li><li><a href="#isotpdump" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">isotpdump</span></a></li><li><a href="#isotpsniffer" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">isotpsniffer</span></a></li><li><a href="#isotpperf" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">isotpperf</span></a></li><li><a href="#isotpserver" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">isotpserver</span></a></li><li><a href="#略微高级-iso-tp-概念" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">（略微）高级 ISO-TP 概念</span></a></li><li><a href="#物理寻址与功能寻址" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">物理寻址与功能寻址</span></a></li><li><a href="#寻址" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">寻址</span></a></li><li><a href="#can-fd" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">CAN FD</span></a></li><li><a href="#故障排除" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">故障排除</span></a></li></ul></div></div></div><div class="content_ff766 rspress-doc-container flex"><div class="flex-1 overflow-x-auto"><div class="rspress-doc"><!--$--><h1 id="与-iso-tp-交互" class="rspress-doc-title text-3xl mb-10 leading-10 tracking-tight title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#与-iso-tp-交互">#</a>与 ISO-TP 交互</h1>
<p class="my-4 leading-7">如 <a href="/docs/userguide/can_tutorial.html#与-can-交互" class="link_a7cea  link_a9ef4 inline-link_f855c">与 CAN 交互</a> 中所述，ECU 通常会通过 CAN 提供诊断功能，并遵循若干标准文档的要求：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><a href="https://en.wikipedia.org/wiki/Unified_Diagnostic_Services" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">统一诊断服务（UDS）</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="https://en.wikipedia.org/wiki/Keyword_Protocol_2000" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">关键字协议 2000（KWP2000）</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="https://en.wikipedia.org/wiki/XCP_(protocol)" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">通用测量与标定协议（XCP）</a></li>
</ul>
<p class="my-4 leading-7">诊断涉及客户端（诊断工具）与服务器（ECU）之间的大量数据传输，例如将新的固件文件发送到 ECU。 CAN 帧的有效载荷最多只能容纳 8 字节（对于 CAN FD 则为 64 字节），因此最好使用传输层来支持更大有效载荷的传输。 <a href="https://en.wikipedia.org/wiki/ISO_15765-2" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">ISO-TP（ISO 15765-2）</a>（有时也称为 CAN-TP）是一种传输层，旨在促进此类数据传输。</p>
<h2 id="iso-tp-基础" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#iso-tp-基础">#</a>ISO-TP 基础</h2>
<p class="my-4 leading-7">ISO-TP（ISO 15765-2）是 UDS 和 KWP2000 使用的传输层。它允许传输最大达 4095 字节的有效载荷。其工作原理是将每个 CAN 帧的第一个字节（或多个字节）用作报头，这一点与 IP 协议占用以太网帧前几个字节的方式类似。</p>
<p class="my-4 leading-7">ISO-TP 通常用于建立一对一的通信通道：一个客户端和一个服务器。客户端通过发送具有特定（静态）标识符的 CAN 帧来发出请求，而服务器则通过发送具有另一个特定（静态）标识符的 CAN 帧进行响应。例如，RAMN 的 ECU B 监听 ID 为 0x7e1 的 CAN 帧（由诊断工具发送），并将其解释为 ISO-TP 帧，然后通过发送 ID 为 0x7e9 的 CAN 帧作出应答。这称为<strong class="font-semibold">正常寻址</strong> ,但还有其他类型的寻址方式（参见<a href="#%E5%AF%BB%E5%9D%80" class="link_a7cea  link_a9ef4 inline-link_f855c">寻址</a>）。</p>
<p class="my-4 leading-7">ISO-TP 报头采用<strong class="font-semibold">动态大小</strong>的报头（协议控制信息，PCI）。报头的类型由报头的第一个半字节（ <strong class="font-semibold">前四位</strong> )定义。共有四种类型的报头：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">单帧 [SF，首字节为 0X]</strong>：这是用于 ISO-TP 有效载荷的单字节报头，适用于 7 字节或更短的有效载荷。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">首帧 [FF，首字节为 1X]</strong>：这是一个两字节报头，用于<strong class="font-semibold">启动</strong> 8 字节或更长 ISO-TP 有效载荷的传输。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">连续帧 [CF，首字节为 2X]</strong>：这是一个单字节报头，用于<strong class="font-semibold">延续</strong>由“首帧”报头开始的传输。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">流控帧 [FC，首字节为 3X]</strong>：这是一个三字节报头，由<strong class="font-semibold">接收方</strong>用来控制 ISO-TP 传输的速度。</li>
</ul>
<p class="my-4 leading-7">尽管 ISO-TP 具备流控机制，但它并未包含用于确认帧已正确重组的“确认”机制。表示 ISO-TP 数据的 CAN 帧可能会用任意值进行填充（常见的填充值包括 0xCC、0xAA 和 0x00），以确保其始终为 8 字节长度。</p>
<h3 id="单帧" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#单帧">#</a>单帧</h3>
<p class="my-4 leading-7">单帧（报头格式为“0X”）是简单的 ISO-TP 帧：其报头表明，整个 ISO-TP 有效载荷包含在 CAN 帧中，位于报头之后。这意味着该 ISO-TP 帧的长度为 7 字节或更短，否则有效载荷及其一字节的报头将无法容纳在一个单独的 CAN 帧中。</p>
<p class="my-4 leading-7">第二个半字节的值表示 ISO-TP 有效载荷的长度。例如，“01”表示一个字节的 ISO-TP 有效载荷，“05”则表示五字节的 ISO-TP 有效载荷。</p>
<p class="my-4 leading-7">对于单帧而言，无需流量控制，因此单帧即代表了整个 ISO-TP 传输过程。例如，如果诊断工具希望向 ECU B 发送 ISO-TP 有效载荷“00 11 22 33 44”（5 字节），它将发送以下 CAN 帧：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>ID: 0x7e1  DLC: 6  Payload: 05 00 11 22 33 44
</code></div></div>
<p class="my-4 leading-7">请注意，ISO-TP 有效载荷的大小为 <strong class="font-semibold">5 字节</strong> ,但相关的 CAN 帧却是 <strong class="font-semibold">6 字节</strong> ,因为 CAN 帧中有一字节用作报头。</p>
<h3 id="首帧与连续帧" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#首帧与连续帧">#</a>首帧与连续帧</h3>
<p class="my-4 leading-7">首帧（报头格式为“1XXX”）与连续帧（报头格式为“2X”）配合使用，以传输大于 7 字节的有效载荷。首帧指定了 ISO-TP 有效载荷的长度，并且<strong class="font-semibold">包含该有效载荷的前 6 个字节</strong> 。首字节的第二位半字节与报头的第二个字节拼接后，表示有效载荷的长度。例如，“10 09”的报头表示一个 9 字节的 ISO-TP 帧，“1F FF”则表示一个 0xFFF（4095）字节的 ISO-TP 帧。</p>
<p class="my-4 leading-7">连续帧包含该有效载荷的剩余部分。报头字节的第二位半字节用作索引，以确保有效载荷能够按顺序重新组装。</p>
<p class="my-4 leading-7">例如，如果诊断工具希望将 ISO-TP 有效载荷“00 11 22 33 44 55 66 77 88 99 AA BB CC DD”（共 14 字节）发送至 ECU B，则会发送以下 CAN 帧：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>ID: 0x7e1  DLC: 8  Payload: 10 0E 00 11 22 33 44 55
ID: 0x7e1  DLC: 8  Payload: 21 66 77 88 99 AA BB CC
ID: 0x7e1  DLC: 2  Payload: 22 DD
</code></div></div>
<p class="my-4 leading-7">请注意，这代表了诊断工具所发送的全部内容，但对于大于7字节的帧，诊断工具实际上<strong class="font-semibold">必须等待流控制帧</strong>，如下文所述。</p>
<h3 id="流量控制帧" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#流量控制帧">#</a>流量控制帧</h3>
<p class="my-4 leading-7">流量控制帧（报头格式为“3XYYZZ”）由 ISO-TP <strong class="font-semibold">接收方</strong>发送，用于控制传输速度。由于此类帧由接收方发送，因此其使用的 CAN ID 与其他帧不同。作为对“首帧”的响应，至少总会发现一个流量控制帧。</p>
<p class="my-4 leading-7">流量控制帧的格式为“3X YY ZZ”，包含以下参数：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">标志位[X，4 位]</strong>：此字段包含实际的流量控制数据。1 表示“继续”，2 表示“等待”，3 表示“中止”。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">块大小 [YY, 8 位]</strong>：此参数指定客户端在等待下一个流量控制帧之前应发送的帧数。0 表示“无需等待，直接发送所有内容”。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">最小分离时间 (STmin) [ZZ, 8 位]</strong>：此字段指定了客户端在帧传输之间应等待的时间。0 表示“尽可能快速发送”，取值范围为 1 到 127 时，表示以毫秒为单位的延迟。0xF1 至 0xF9 用于指定 100 毫秒到 900 毫秒之间的较大延迟。介于这些值之间的数值已被标准保留。</li>
</ul>
<p class="my-4 leading-7">现代 ECU 通常会以“30 00 00”作为对“第一帧”的响应，这意味着“以最高速度发送所有数据”——在这种情况下，这将是整个通信过程中唯一的流控制帧。</p>
<p class="my-4 leading-7">如果 ECU 回复的是“30 00 F9”，客户端也会在不等待流控制帧的情况下发送所有帧，但每帧之间会间隔 900 毫秒。</p>
<p class="my-4 leading-7">如果 ECU 回复的是“30 01 00”，客户端将发送第一个“连续帧”，并在继续发送之前等待另一个流控制帧。</p>
<h3 id="示例" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#示例">#</a>示例</h3>
<p class="my-4 leading-7">以下是一个完整的 ISO-TP 传输示例：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>ID: 0x7e1  DLC: 8  Payload: 10 0E 00 11 22 33 44 55 (&quot;I want to send a 14-byte payload, here are the first bytes&quot;)
ID: 0x7e9  DLC: 3  Payload: 30 00 00 (&quot;Send the rest without waiting, at maximum speed&quot;)
ID: 0x7e1  DLC: 8  Payload: 21 66 77 88 99 AA BB CC (&quot;Here is the second part&quot;)
ID: 0x7e1  DLC: 2  Payload: 22 DD (&quot;Here is the third part&quot;)
</code></div></div>
<p class="my-4 leading-7">请注意，最后没有确认应答。如果 ECU 使用的块大小不为零，则相同的数据交换将如下所示。</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>ID: 0x7e1  DLC: 8  Payload: 10 0E 00 11 22 33 44 55 (&quot;I want to send a 14-byte payload, here are the first bytes&quot;)
ID: 0x7e9  DLC: 3  Payload: 30 01 00 (&quot;Send one CAN frame and wait&quot;)
ID: 0x7e1  DLC: 8  Payload: 21 66 77 88 99 AA BB CC (&quot;Here is the second part&quot;)
ID: 0x7e9  DLC: 3  Payload: 30 01 00 (&quot;Send one CAN frame and wait&quot;)
ID: 0x7e1  DLC: 2  Payload: 22 DD (&quot;Here is the third part&quot;)
</code></div></div>
<h2 id="linux-上的-iso-tp" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#linux-上的-iso-tp">#</a>Linux 上的 ISO-TP</h2>
<p class="my-4 leading-7">can-utils 软件包提供了<a href="https://github.com/linux-can/can-utils/blob/master/README.md" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">多种工具</a>用于与 ISO-TP 交互。您可能会用到以下三个命令：<strong class="font-semibold">isotpsend</strong> 用于发送 ISO-TP 帧，<strong class="font-semibold">isotprecv</strong> 用于接收 ISO-TP 帧，以及 <strong class="font-semibold">isotpdump</strong> 用于转储并解析 ISO-TP 流量。此外，您仍然可以使用前一指南中介绍的基本命令（参见<a href="/docs/userguide/can_tutorial.html#与-can-交互" class="link_a7cea  link_a9ef4 inline-link_f855c">与 CAN 交互</a>）。</p>
<p class="my-4 leading-7">UDS 命令将在另一节中详细说明。本节主要使用基本的 UDS 命令 “3E 00”，该命令应由 ECU 回应 “7E 00”。我们将此命令发送至 ECU B，它使用 ID 0x7e1 接收命令，使用 ID 0x7e9 回应命令。任何其他随机命令，很可能是无效的，应以 <code>7F &lt;您发送的第一个字节&gt; &lt;错误码字节&gt;</code> 来回应，以指示您的命令存在错误。</p>
<h3 id="candump" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#candump">#</a>candump</h3>
<p class="my-4 leading-7">在使用 ISO-TP 进行实验时，你可能希望显示原始的 CAN 流量。这可以通过使用 candump 并配合正确的过滤器来实现。例如，如果你只想显示 ECU B 的 ISO-TP 流量对应的 CAN 帧，则应仅显示 ID 为 0x7e1 和 0x7e9 的 CAN 帧：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>candump can0,7e1:7ff,7e9:7ff
</code></div></div>
<p class="my-4 leading-7">如果您想显示现代车辆中通常出现的所有 ISO-TP 帧，可以使用 ID 介于 0x7e0 和 0x7f 之间的过滤器来筛选帧（请参阅 <a href="/docs/userguide/can_tutorial.html#can-过滤器" class="link_a7cea  link_a9ef4 inline-link_f855c">CAN 过滤器 </a>）：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>candump can0,7e0:7f0
</code></div></div>
<p class="my-4 leading-7">在试验 ISO-TP 时，建议您始终保留一个终端执行此命令，以便可以直接观察 CAN 帧。</p>
<h3 id="cansend" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#cansend">#</a>cansend</h3>
<p class="my-4 leading-7">尽管不推荐这样做，但并没有任何限制阻止您手动创建 ISO-TP 报头并发送 CAN 帧。要将 ISO-TP 有效载荷“3E 00”发送到 ECU B，您可以输入以下命令：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>cansend can0 7e1#023E00
</code></div></div>
<p class="my-4 leading-7">在您的 candump 终端上，您应该会看到两条消息：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">您的请求（“3E 00”，由您通过 ID 0x7e1 发送）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">ECU 的响应（“7E 00”，由 ECU B 通过 ID 0x7e9 发送）。</li>
</ul>
<p class="my-4 leading-7"><img src="/userguide/cansend_isotp.webp" alt=""/></p>
<p class="my-4 leading-7">请注意，CAN 帧的 DLC（有效载荷大小）为 3，但 ISO-TP 有效载荷仅为 2 字节——这是因为 CAN 有效载荷的第一个字节用于指示 ISO-TP 有效载荷的大小。此外，请注意，您的请求 CAN 报文中并未指定响应 CAN ID，该 ID 是静态设定的，不同于 TCP 等其他协议中的源端口和目的端口。</p>
<p class="my-4 leading-7">如果您忽略流控制帧，并仅寄希望于时间 timing 正确，也可以直接发送分段帧。例如，要发送有效载荷 00 11 22 33 44 55 66 77（8 字节），您可以输入：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>cansend can0 7e1#1008001122334455 &amp;&amp; cansend can0 7e1#216677
</code></div></div>
<p class="my-4 leading-7">并在 candump 中观察响应结果。</p>
<p class="my-4 leading-7"><img src="/userguide/cansend_isotp2.webp" alt=""/></p>
<p class="my-4 leading-7">尽管在 ISO-TP 上层可能会出现错误信息（例如上述截图中的“7F 00 31”UDS 错误消息），但 <strong class="font-semibold">在 ISO-TP 层却没有任何错误信息</strong> 。如果在格式化 ISO-TP 帧时出现错误，ECU 将直接不予响应。例如，对于以下格式错误的请求，ECU 不会作出任何回应，也不会报告相关错误。</p>
<p class="my-4 leading-7"><img src="/userguide/cansend_isotp3.webp" alt=""/></p>
<p class="my-4 leading-7"><img src="/userguide/cansend_isotp4.webp" alt=""/></p>
<p class="my-4 leading-7">ECU 通常对 ISO-TP 请求设置了非常快速的超时机制，如果帧发送不够迅速，传输将被关闭。建议您不要自行格式化 ISO-TP 帧，而是使用诸如 <strong class="font-semibold">isotpsend</strong> 之类的工具。</p>
<h3 id="isotpsend" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#isotpsend">#</a>isotpsend</h3>
<p class="my-4 leading-7">命令 isotpsend 允许您向 ISO-TP 服务器发送任意有效载荷。作为参数，您需要提供 CAN 接口、源 CAN ID（客户端用于传输数据的 ID）以及目标 CAN ID（服务器用于传输流控帧的 ID）。有效载荷必须通过标准输入逐字节提供。在 Linux 中，这可以使用 echo 命令来完成。例如，使用以下命令将两字节的 ISO-TP 有效载荷“3E 00”发送到 ECU B：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>echo &quot;3E 00&quot; | isotpsend -s 7e1 -d 7e9 can0
</code></div></div>
<p class="my-4 leading-7"><img src="/userguide/isotpsend_test.webp" alt=""/></p>
<p class="my-4 leading-7">这与之前使用 candump 捕获的 CAN 流量完全相同，只不过这次您无需自己添加报头。不过，您仍需提供目标 ID，因为 isotpsend 会等待流控帧的到来。</p>
<p class="my-4 leading-7">注意</p>
<p class="my-4 leading-7">请注意，“源”对应于目标 ECU 所监听的 ID——这一点对某些人来说可能有些反直觉。与 TCP 协议中的“源”和“目的”的类比存在局限性：对于 ISO-TP 而言，“源”和“目的”ID 是一组静态配对。如果你想与另一个 ECU 通信，你需要同时更改<strong class="font-semibold">源</strong>和<strong class="font-semibold">目的</strong> 。</p>
<p class="my-4 leading-7">你可以使用 isotpsend 发送最大 4095 字节的有效载荷，而无需担心 ISO-TP 的格式问题。例如：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>echo &quot;00 11 22 33 44 55 66 77 88 99 AA BB CC DD EE FF 00 11 22 33&quot; | isotpsend -s 7e1 -d 7e9 can0
</code></div></div>
<p class="my-4 leading-7">应显示如下截图所示的流量。</p>
<p class="my-4 leading-7"><img src="/userguide/isotpsend_test3.webp" alt=""/></p>
<p class="my-4 leading-7">如果你只想测试 ISO-TP 链路，而对有效载荷内容不关心，可以使用-D 选项让 isotpsend 为你生成特定大小的有效载荷。此外，你还可以使用-f 功能来强制设置客户端分离时间的值（单位为纳秒）。例如，使用以下命令生成一个 100 字节的有效载荷，并在每次传输之间设置 1 秒的延迟：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>isotpsend -s 7e1 -d 7e9 -D 100 -f 1000000000 can0
</code></div></div>
<p class="my-4 leading-7">你应该能够在 candump 终端中观察到缓慢的传输过程。</p>
<p class="my-4 leading-7"><img src="/userguide/isotpsend_test2.webp" alt=""/></p>
<h3 id="isotprecv" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#isotprecv">#</a>isotprecv</h3>
<p class="my-4 leading-7">命令 isotpsend 允许您发送 ISO-TP 帧，但它不会监听来自服务器（ECU）的响应。为此，您需要在另一个终端中使用 isotprecv，并指定相同的参数：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>isotprecv -s 7e1 -d 7e9 can0
</code></div></div>
<p class="my-4 leading-7">这将接收一个有效载荷后关闭，但您可以使用 -l 选项来监听多个 ISO-TP 有效载荷：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>isotprecv -s 7e1 -d 7e9 -l can0
</code></div></div>
<p class="my-4 leading-7">如果您在一个终端中打开其中一条命令，并在另一个终端中使用 isotpsend，那么您应该能够在 isotprecv 终端中看到 ECU 对您的 ISO-TP 有效载荷的响应。例如，在另一个终端中输入以下命令：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>echo &quot;3E 00&quot; | isotpsend -s 7e1 -d 7e9 can0
</code></div></div>
<p class="my-4 leading-7">然后观察 isotprecv 终端，它应该会显示来自 ECU 的响应。</p>
<p class="my-4 leading-7"><img src="/userguide/isotprecv_test.webp" alt=""/></p>
<div class="rspress-directive warning"><div class="rspress-directive-title">警告</div><div class="rspress-directive-content"><p class="my-4 leading-7">使用 isotprecv 和 isotpsend 时，请勿混淆源和目标——它们应使用相同的参数。如果您改为使用 <code>isotprecv -s 7e9 -d 7e1 can0</code>,您将不会监听 ECU B 的响应，而是会伪装成 ECU B，并监听与之相同的命令。通常情况下，真实 ECU 中的源 ID 低于目标 ID，因此：</p><ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">如果第一个参数小于第二个参数，则您正在监听 ECU 的响应（典型用法）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">如果第二个参数小于第一个参数，则您正在伪装成一个 ECU（例如，如果您想开发一个 ECU 模拟器）。</li>
</ul></div></div>
<p class="my-4 leading-7">请注意，请求不会显示在 isotprecv 中，仅显示响应。您可以使用 isotpdump 在同一终端中同时显示请求和响应。</p>
<h3 id="isotpdump" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#isotpdump">#</a>isotpdump</h3>
<p class="my-4 leading-7">命令 isotpdump 将在同一窗口中同时显示请求和响应。与 candump 类似，建议您保持一个终端窗口始终打开该命令。</p>
<p class="my-4 leading-7">使用以下命令转储您与 ECU B 之间的流量：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>isotpdump -s 7e1 -d 7e9 -c can0
</code></div></div>
<p class="my-4 leading-7">-c 选项为消息添加颜色，以便轻松区分请求（红色）和响应（蓝色）。</p>
<p class="my-4 leading-7">如果您在另一个终端中输入以下 isotpsend 命令，应该能够观察到 ISO-TP 流量。</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>echo &quot;3E 00&quot; | isotpsend -s 7e1 -d 7e9 can0
</code></div></div>
<p class="my-4 leading-7"><img src="/userguide/isotpdump_test.webp" alt=""/></p>
<p class="my-4 leading-7">您可以使用-a 选项以显示 ASCII 格式，并使用-u 选项将有效载荷解释为 UDS 流量：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>isotpdump -s 7e1 -d 7e9 -c can0 -a -u
</code></div></div>
<p class="my-4 leading-7"><img src="/userguide/isotpdump_test3.webp" alt=""/></p>
<p class="my-4 leading-7">与 candump 不同，isotpdump 会自动去除报头，方便您直接识别实际的 ISO-TP 有效载荷。不过，它仍然会逐个显示 CAN 帧。当有效载荷较大时，这种显示方式可能会显得有些繁杂，例如：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>isotpsend -s 7e1 -d 7e9 can0 -D 200
</code></div></div>
<p class="my-4 leading-7"><img src="/userguide/isotpdump_test2.webp" alt=""/></p>
<h3 id="isotpsniffer" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#isotpsniffer">#</a>isotpsniffer</h3>
<p class="my-4 leading-7">如果您只想查看重构的有效载荷，可以改用 isotpsniffer。您可以使用以下语法：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>isotpsniffer -s 7e1 -d 7e9 can0 -c
</code></div></div>
<p class="my-4 leading-7">这应该只会显示重构后的有效载荷，例如在使用 isotpsend 传输大容量有效载荷时：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>isotpsend -s 7e1 -d 7e9 can0 -D 100
</code></div></div>
<p class="my-4 leading-7"><img src="/userguide/isotpsniffer_test.webp" alt=""/></p>
<h3 id="isotpperf" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#isotpperf">#</a>isotpperf</h3>
<p class="my-4 leading-7">您可以使用 isotpperf 来测量 ISO-TP 连接的性能，例如针对 ECU B：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>isotpperf -s 7e1 -d 7e9 can0
</code></div></div>
<p class="my-4 leading-7">这将显示正在进行的传输，并测量其耗时。</p>
<p class="my-4 leading-7">您可以通过本地强制设置-STmin 值（使用-f 选项）来尝试各种传输。打开另一个窗口，输入以下命令以发送最大尺寸且具有不同时间间隔的有效载荷：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>isotpsend -s 7e1 -d 7e9 can0 -f 100000 -D 4095
isotpsend -s 7e1 -d 7e9 can0 -f 1000000 -D 4095
isotpsend -s 7e1 -d 7e9 can0 -f 10000000 -D 4095
</code></div></div>
<p class="my-4 leading-7"><img src="/userguide/isotpperf_test.webp" alt=""/></p>
<h3 id="isotpserver" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#isotpserver">#</a>isotpserver</h3>
<p class="my-4 leading-7">如果您希望通过 IP 网络访问 ECU 的 ISO-TP 服务器，可以使用 isotpserver。例如，如果您希望将来自 ECU B（ISO-TP 对 0x7e1/0x7e9）的 ISO-TP 流量转发到 IP 端口 7777，可以使用以下命令：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>isotpserver -s 7e1 -d 7e9 -l 7777 can0
</code></div></div>
<div class="rspress-directive warning"><div class="rspress-directive-title">警告</div><div class="rspress-directive-content"><p class="my-4 leading-7">此命令允许任何能够访问您 IP 服务器的人员与 ECU B 进行通信。请仅在您清楚自己操作的情况下使用此功能。</p></div></div>
<p class="my-4 leading-7">您可以使用例如 netcat 连接到此端口：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>nc localhost 7777
</code></div></div>
<p class="my-4 leading-7">您可以发送以 ASCII 格式嵌入在尖括号 <code>&lt;&gt;</code> 中的 ISO-TP 帧，例如，如果您输入 <code>&lt;3E00&gt;</code> 并按下回车键，您应在同一终端中收到 <code>&lt;7E00&gt;</code> 。</p>
<p class="my-4 leading-7"><img src="/userguide/isotpserver_test.webp" alt=""/></p>
<p class="my-4 leading-7">此命令可用于远程与多人共享一个 ECU。但请注意，只有 ISO-TP 响应（且仅限响应）会被广播给所有客户端。您还可以使用 <strong class="font-semibold">isotptun</strong> 命令创建基于 ISO-TP 的 IP 隧道。</p>
<h2 id="略微高级-iso-tp-概念" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#略微高级-iso-tp-概念">#</a>（略微）高级 ISO-TP 概念</h2>
<h3 id="物理寻址与功能寻址" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#物理寻址与功能寻址">#</a>物理寻址与功能寻址</h3>
<p class="my-4 leading-7">寻址方式有两种：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">物理寻址</li>
<li class="[&amp;:not(:first-child)]:mt-2">功能寻址</li>
</ul>
<p class="my-4 leading-7">在正常寻址模式下，诊断工具一次仅与一个 ECU 进行通信。</p>
<p class="my-4 leading-7">在功能寻址中，诊断工具可以同时与一组 ECU 进行通信。它仅支持单帧，因为单帧无需流量控制，因此多个接收端可轻松同时接收。ECU 常用的函数地址为 0x7DF，该地址由 <a href="https://en.wikipedia.org/wiki/OBD-II_PIDs" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">OBD-II PID</a> 定义。</p>
<h3 id="寻址" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#寻址">#</a>寻址</h3>
<p class="my-4 leading-7">ISO-TP 中定义了多种寻址类型：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">普通寻址</strong> ：地址 ID 完全包含在 CAN 标识符中（例如，ECU B 的 0x7e1 和 0x7e9）。它适用于标准（11 位）和扩展（29 位）CAN 标识符。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">普通固定寻址</strong> ：这是普通寻址的一种子格式，仅适用于 29 位扩展标识符，其中地址必须遵循 <a href="https://www.csselectronics.com/pages/j1939-explained-simple-intro-tutorial" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">J1939 格式 </a>。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">扩展寻址</strong> ：CAN 有效载荷的第一个字节用作额外的地址字节。这意味着单帧和连续帧的报头大小变为两个字节，首帧为三个字节，流控帧则为四个字节。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">混合寻址</strong> ：正常固定寻址与扩展寻址的混合使用。</li>
</ul>
<h3 id="can-fd" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#can-fd">#</a>CAN FD</h3>
<p class="my-4 leading-7">较新版本的 ISO-TP 利用了 CAN FD 提供的额外带宽（参见 <a href="/docs/userguide/can_tutorial.html#can-fd" class="link_a7cea  link_a9ef4 inline-link_f855c">CAN FD</a>）。具体而言：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">单帧可容纳最多 62 字节的有效载荷。为此，CAN 帧的第一个字节应为“00”，而紧随其后的字节则用于指示 ISO-TP 有效载荷的大小（最多 62 字节，因为前两个字节已被报头占用）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">分段帧（首帧+连续帧）可容纳最大 4GB 大小的有效载荷。为此，前两个字节应为“1000”，而随后的四个字节则用于指示 ISO-TP 有效载荷的大小。</li>
</ul>
<h3 id="故障排除" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#故障排除">#</a>故障排除</h3>
<p class="my-4 leading-7">如果您遇到超时问题（例如出现“read socket t: Connection timed out”之类的错误信息），这表明连接不可靠，即以下情况之一：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">ECU A（您的 USB 转 CAN 适配器）将数据从 USB 传输到 CAN 的速度不够快。</li>
<li class="[&amp;:not(:first-child)]:mt-2">您的 PC 通过 USB 发送的数据不正确。</li>
</ul>
<p class="my-4 leading-7">如果问题出在 ECU A 上，其屏幕上应会显示错误信息。</p>
<p class="my-4 leading-7">如果您使用的是虚拟机，其 USB 设置可能不够可靠。在 VirtualBox 中，前往“设置”-&gt;“USB”，并勾选“USB 3.0 (xHCI) 控制器”（请确保您的虚拟机已关闭）。</p>
<p class="my-4 leading-7">如果仍然失败，请尝试使用 -f 选项与 isotpsend 配合，以强制其降低速度，例如使用“-f 100000”。</p><!--/$--></div><div class="rspress-doc-footer"><footer class="mt-8"><div class="xs:flex pb-5 px-2 justify-end items-center"></div><div class="flex flex-col"></div><div class="flex flex-col sm:flex-row sm:justify-around gap-4 pt-6"><div class="prev_c92d1 flex flex-col"><a href="/docs/userguide/can_tutorial.html" class="link_a7cea pager-link_e0d2d"><span class="desc_dcc01">Previous Page</span><span class="title_a3acb">与 CAN 交互</span></a></div><div class="next_c11be flex flex-col"><a href="/docs/userguide/diag_tutorial.html" class="link_a7cea pager-link_e0d2d next_ad355"><span class="desc_dcc01">Next Page</span><span class="title_a3acb">与 UDS 交互</span></a></div></div></footer></div></div><div class="aside-container_bc5fa"><div class="flex flex-col"><div id="aside-container" class="relative text-sm font-medium"><div class="leading-7 block text-sm font-semibold pl-3">目录</div><nav class="mt-1"><ul class="relative"><li><a href="#iso-tp-基础" title="ISO-TP 基础" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">ISO-TP 基础</span></a></li><li><a href="#单帧" title="单帧" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">单帧</span></a></li><li><a href="#首帧与连续帧" title="首帧与连续帧" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">首帧与连续帧</span></a></li><li><a href="#流量控制帧" title="流量控制帧" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">流量控制帧</span></a></li><li><a href="#示例" title="示例" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">示例</span></a></li><li><a href="#linux-上的-iso-tp" title="Linux 上的 ISO-TP" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">Linux 上的 ISO-TP</span></a></li><li><a href="#candump" title="candump" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">candump</span></a></li><li><a href="#cansend" title="cansend" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">cansend</span></a></li><li><a href="#isotpsend" title="isotpsend" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">isotpsend</span></a></li><li><a href="#isotprecv" title="isotprecv" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">isotprecv</span></a></li><li><a href="#isotpdump" title="isotpdump" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">isotpdump</span></a></li><li><a href="#isotpsniffer" title="isotpsniffer" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">isotpsniffer</span></a></li><li><a href="#isotpperf" title="isotpperf" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">isotpperf</span></a></li><li><a href="#isotpserver" title="isotpserver" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">isotpserver</span></a></li><li><a href="#略微高级-iso-tp-概念" title="（略微）高级 ISO-TP 概念" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">（略微）高级 ISO-TP 概念</span></a></li><li><a href="#物理寻址与功能寻址" title="物理寻址与功能寻址" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">物理寻址与功能寻址</span></a></li><li><a href="#寻址" title="寻址" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">寻址</span></a></li><li><a href="#can-fd" title="CAN FD" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">CAN FD</span></a></li><li><a href="#故障排除" title="故障排除" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">故障排除</span></a></li></ul></nav></div></div></div></div></div></div></section></div>
    <div id="search-container"></div>
  </body>
</html>
