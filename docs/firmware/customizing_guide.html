<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Rspress v1.45.6">
    <title data-rh="true">自定义指南 - RAMN 文档：抗干扰汽车微型网络</title>
  <script>{;const saved = localStorage.getItem('rspress-theme-appearance');const preferDark = window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = !saved || saved === 'auto' ? preferDark : saved === 'dark';document.documentElement.classList.toggle('dark', isDark);document.documentElement.style.colorScheme = isDark ? 'dark' : 'light';}</script><link rel="icon" href="/ramn-cartoon.png"><script defer src="/static/js/styles.197c6af7.js"></script><script defer src="/static/js/lib-react.78f62612.js"></script><script defer src="/static/js/lib-router.eb40978d.js"></script><script defer src="/static/js/162.c1fe1a1e.js"></script><script defer src="/static/js/index.4245ed64.js"></script><link href="/static/css/styles.eb04fe59.css" rel="stylesheet"></head>

  <body >
    <div id="root"><div class="navContainer_d18b1 rspress-nav px-6  sticky_ddfa7"><div class="container_e4235 flex justify-between items-center h-full"><div class="navBarTitle_c5f07"><a href="/index.html" class="link_a7cea flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60"><div class="mr-1 min-w-8"><img src="/ramn-light-logo.png" alt="logo" id="logo" class="rspress-logo dark:hidden"/><img src="/ramn-dark-logo.png" alt="logo" id="logo" class="rspress-logo hidden dark:block"/></div></a></div><div class="flex flex-1 justify-end items-center"><div class="rightNav_a2fea"><div class="flex sm:flex-1 items-center sm:pl-4 sm:pr-2"><div class="rspress-nav-search-button navSearchButton_df1fb"><button><svg width="18" height="18" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9"></path></svg><p class="searchWord_af2c1">Search</p><div style="opacity:0"><span></span><span>K</span></div></button></div><div class="mobileNavSearchButton_d85a9"><svg width="24" height="24" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9"></path></svg></div></div><div class="rspress-nav-menu menu h-14"><a href="/docs/general.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154 activeItem_a28b5 text-sm font-medium mx-1.5 px-3 py-2 flex items-center break-keep">文档</div></a><a href="/case/index.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center break-keep">成品展示</div></a></div><div class="flex-center flex-row"><div class="mx-2"><div class="md:mr-2 rspress-nav-appearance"><div class="p-1 border border-solid border-gray-300 text-gray-400  cursor-pointer rounded-md hover:border-gray-600 hover:text-gray-600 dark:hover:border-gray-200 dark:hover:text-gray-200 transition-all duration-300 w-7 h-7"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="dark:hidden" width="18" height="18" fill="currentColor"><path d="M12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6m0-10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4M12 4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1M12 24c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1M5.6 6.6c-.3 0-.5-.1-.7-.3L3.5 4.9c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.1.2-.4.3-.7.3M19.8 20.8c-.3 0-.5-.1-.7-.3l-1.4-1.4c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.2.2-.5.3-.7.3M3 13H1c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1M23 13h-2c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1M4.2 20.8c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.4.3-.7.3M18.4 6.6c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.5.3-.7.3"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="hidden dark:block" width="18" height="18" fill="currentColor"><path d="M12.1 22h-.9c-5.5-.5-9.5-5.4-9-10.9.4-4.8 4.2-8.6 9-9 .4 0 .8.2 1 .5s.2.8-.1 1.1c-2 2.7-1.4 6.4 1.3 8.4 2.1 1.6 5 1.6 7.1 0 .3-.2.7-.3 1.1-.1.3.2.5.6.5 1-.2 2.7-1.5 5.1-3.6 6.8-1.9 1.4-4.1 2.2-6.4 2.2M9.3 4.4c-2.9 1-5 3.6-5.2 6.8-.4 4.4 2.8 8.3 7.2 8.7 2.1.2 4.2-.4 5.8-1.8 1.1-.9 1.9-2.1 2.4-3.4-2.5.9-5.3.5-7.5-1.1-2.8-2.2-3.9-5.9-2.7-9.2"></path></svg></div></div></div><div class="social-links menu-item_e90a6 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/ToyotaInfoTech/RAMN" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a><a href="https://h4cker.zip/" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364q.204-.03.415-.056q-.207.033-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a9 9 0 0 1-.415-.056q.21.026.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8"/></svg></div></div></a><a href="https://space.bilibili.com/434014419" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M17.813 4.653h.854q2.266.08 3.773 1.574Q23.946 7.72 24 9.987v7.36q-.054 2.266-1.56 3.773c-1.506 1.507-2.262 1.524-3.773 1.56H5.333q-2.266-.054-3.773-1.56C.053 19.614.036 18.858 0 17.347v-7.36q.054-2.267 1.56-3.76t3.773-1.574h.774l-1.174-1.12a1.23 1.23 0 0 1-.373-.906q0-.534.373-.907l.027-.027q.4-.373.92-.373t.92.373L9.653 4.44q.107.106.187.213h4.267a.8.8 0 0 1 .16-.213l2.853-2.747q.4-.373.92-.373c.347 0 .662.151.929.4s.391.551.391.907q0 .532-.373.906zM5.333 7.24q-1.12.027-1.88.773q-.76.748-.786 1.894v7.52q.026 1.146.786 1.893t1.88.773h13.334q1.12-.026 1.88-.773t.786-1.893v-7.52q-.026-1.147-.786-1.894t-1.88-.773zM8 11.107q.56 0 .933.373q.375.374.4.96v1.173q-.025.586-.4.96q-.373.375-.933.374c-.56-.001-.684-.125-.933-.374q-.375-.373-.4-.96V12.44q0-.56.386-.947q.387-.386.947-.386m8 0q.56 0 .933.373q.375.374.4.96v1.173q-.025.586-.4.96q-.373.375-.933.374c-.56-.001-.684-.125-.933-.374q-.375-.373-.4-.96V12.44q.025-.586.4-.96q.373-.373.933-.373"/></svg></div></div></a><div class="social-links-icon_a4ad0 cursor-pointer relative mx-3"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213c0 .163.13.295.29.295a.33.33 0 0 0 .167-.054l1.903-1.114a.86.86 0 0 1 .717-.098a10.2 10.2 0 0 0 2.837.403c.276 0 .543-.027.811-.05c-.857-2.578.157-4.972 1.932-6.446c1.703-1.415 3.882-1.98 5.853-1.838c-.576-3.583-4.196-6.348-8.596-6.348M5.785 5.991c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178A1.17 1.17 0 0 1 4.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178a1.17 1.17 0 0 1-1.162-1.178c0-.651.52-1.18 1.162-1.18m5.34 2.867c-1.797-.052-3.746.512-5.28 1.786c-1.72 1.428-2.687 3.72-1.78 6.22c.942 2.453 3.666 4.229 6.884 4.229c.826 0 1.622-.12 2.361-.336a.72.72 0 0 1 .598.082l1.584.926a.3.3 0 0 0 .14.047c.134 0 .24-.111.24-.247c0-.06-.023-.12-.038-.177l-.327-1.233a.6.6 0 0 1-.023-.156a.49.49 0 0 1 .201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89c-.135-.01-.27-.027-.407-.03zm-2.53 3.274c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983a.976.976 0 0 1-.969-.983c0-.542.434-.982.97-.982zm4.844 0c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983a.976.976 0 0 1-.969-.983c0-.542.434-.982.969-.982"/></svg></div></div></div></div></div></div><div class="mobileNavMenu_e7045"><div class="navScreen_ec30c  rspress-nav-screen" id="navScreen"><div class="container_c935d"><div class="navMenu_b887b"><div class="navMenuItem_e7978 w-full"><a href="/docs/general.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154 activeItem_a28b5 text-sm font-medium mx-1.5 px-3 py-2 flex items-center break-keep">文档</div></a></div><div class="navMenuItem_e7978 w-full"><a href="/case/index.html" class="link_a7cea "><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center break-keep">成品展示</div></a></div></div><div class="flex-center flex-col gap-2"><div class="mt-2 navAppearance_bf893 flex justify-center"></div><div class="social-links menu-item_e90a6 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/ToyotaInfoTech/RAMN" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a><a href="https://h4cker.zip/" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364q.204-.03.415-.056q-.207.033-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a9 9 0 0 1-.415-.056q.21.026.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8"/></svg></div></div></a><a href="https://space.bilibili.com/434014419" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M17.813 4.653h.854q2.266.08 3.773 1.574Q23.946 7.72 24 9.987v7.36q-.054 2.266-1.56 3.773c-1.506 1.507-2.262 1.524-3.773 1.56H5.333q-2.266-.054-3.773-1.56C.053 19.614.036 18.858 0 17.347v-7.36q.054-2.267 1.56-3.76t3.773-1.574h.774l-1.174-1.12a1.23 1.23 0 0 1-.373-.906q0-.534.373-.907l.027-.027q.4-.373.92-.373t.92.373L9.653 4.44q.107.106.187.213h4.267a.8.8 0 0 1 .16-.213l2.853-2.747q.4-.373.92-.373c.347 0 .662.151.929.4s.391.551.391.907q0 .532-.373.906zM5.333 7.24q-1.12.027-1.88.773q-.76.748-.786 1.894v7.52q.026 1.146.786 1.893t1.88.773h13.334q1.12-.026 1.88-.773t.786-1.893v-7.52q-.026-1.147-.786-1.894t-1.88-.773zM8 11.107q.56 0 .933.373q.375.374.4.96v1.173q-.025.586-.4.96q-.373.375-.933.374c-.56-.001-.684-.125-.933-.374q-.375-.373-.4-.96V12.44q0-.56.386-.947q.387-.386.947-.386m8 0q.56 0 .933.373q.375.374.4.96v1.173q-.025.586-.4.96q-.373.375-.933.374c-.56-.001-.684-.125-.933-.374q-.375-.373-.4-.96V12.44q.025-.586.4-.96q.373-.373.933-.373"/></svg></div></div></a><div class="social-links-icon_a4ad0 cursor-pointer relative mx-3"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213c0 .163.13.295.29.295a.33.33 0 0 0 .167-.054l1.903-1.114a.86.86 0 0 1 .717-.098a10.2 10.2 0 0 0 2.837.403c.276 0 .543-.027.811-.05c-.857-2.578.157-4.972 1.932-6.446c1.703-1.415 3.882-1.98 5.853-1.838c-.576-3.583-4.196-6.348-8.596-6.348M5.785 5.991c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178A1.17 1.17 0 0 1 4.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178a1.17 1.17 0 0 1-1.162-1.178c0-.651.52-1.18 1.162-1.18m5.34 2.867c-1.797-.052-3.746.512-5.28 1.786c-1.72 1.428-2.687 3.72-1.78 6.22c.942 2.453 3.666 4.229 6.884 4.229c.826 0 1.622-.12 2.361-.336a.72.72 0 0 1 .598.082l1.584.926a.3.3 0 0 0 .14.047c.134 0 .24-.111.24-.247c0-.06-.023-.12-.038-.177l-.327-1.233a.6.6 0 0 1-.023-.156a.49.49 0 0 1 .201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89c-.135-.01-.27-.027-.407-.03zm-2.53 3.274c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983a.976.976 0 0 1-.969-.983c0-.542.434-.982.97-.982zm4.844 0c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983a.976.976 0 0 1-.969-.983c0-.542.434-.982.969-.982"/></svg></div></div></div></div></div></div></div><button aria-label="mobile hamburger" class=" rspress-mobile-hamburger navHamburger_ac64c text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="currentColor"><circle cx="8" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="24" cy="16" r="2" fill="currentColor"></circle></svg></button></div></div></div></div><section><div class="docLayout_af141 pt-0"><aside class="sidebar_dd719 rspress-sidebar "><div class="navTitleMask_fb17c"><div class="navBarTitle_c5f07"><a href="/index.html" class="link_a7cea flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60"><div class="mr-1 min-w-8"><img src="/ramn-light-logo.png" alt="logo" id="logo" class="rspress-logo dark:hidden"/><img src="/ramn-dark-logo.png" alt="logo" id="logo" class="rspress-logo hidden dark:block"/></div></a></div></div><div class="rspress-scrollbar sidebarContent_da296"><nav class="pb-2"><a href="/docs/general.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>介绍</span></div></a><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">硬件</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/docs/hardware/overview.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>概述</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/expansions.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>扩展端口</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/ordering.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>PCB 订购</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/flashing.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>固件刷写</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/qualitycheck.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>质量检查</span></div></a></div><div class="rspress-sidebar-item"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:18px"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex"><span class="flex-center" style="font-size:13px">原理图详情</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:0"><div class="rspress-sidebar-item"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:18px"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex"><span class="flex-center" style="font-size:13px">ECUs</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:0"><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/ecus/powersupply.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>电源</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/ecus/microcontroller.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>微控制器</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/ecus/canphy.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>CAN-FD 收发器</span></div></a></div></div></div></section></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/canbus.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>CAN/CAN-FD 总线</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/usb.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>USB</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/screens.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>屏幕（网关/信息娱乐）</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/chassis.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>底盘</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/powertrain.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>动力总成</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/body.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>车身</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/hardware/schematics/debugger.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>调试器</span></div></a></div></div></div></section></div></div></div></section><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">固件</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/docs/firmware/customizing_guide.html" class="link_a7cea menuLink_bb039"><div class="menuItemActive_de63c mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>自定义指南</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/firmware/architecture.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>固件架构</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/firmware/memory_layout.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>内存布局</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/firmware/common_issues.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>故障排除</span></div></a></div></div></div></section><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">脚本</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/docs/scripts/install.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>配置 RAMN 的脚本</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/scripts/carla.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>CARLA</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/scripts/vcand.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>vcand</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/scripts/build.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>构建</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/scripts/diagnostics.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>诊断</span></div></a></div></div></div></section><a href="/docs/quickstart.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>快速入门指南</span></div></a><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">用户指南</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(0deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden;max-height:0"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:0;margin-left:12px"><div class="rspress-sidebar-item"><a href="/docs/userguide/ramn_introduction.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>简介</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/userguide/can_tutorial.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>与 CAN 交互</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/userguide/isotp_tutorial.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>与 ISO-TP 交互</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/userguide/diag_tutorial.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>与 UDS 交互</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/userguide/usb_tutorial.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>与 USB 交互</span></div></a></div><div class="rspress-sidebar-item"><a href="/docs/userguide/going_further.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>更进一步</span></div></a></div></div></div></section><a href="/docs/minictf.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>CTF训练</span></div></a><a href="/docs/ctf_writeups.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>CTF题解</span></div></a><a href="/docs/translation.html" class="link_a7cea menuLink_bb039"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>翻译</span></div></a></nav></div></aside><div class="flex-1 relative min-w-0"><div class="rspress-sidebar-menu-container "><div class="rspress-sidebar-menu"><button type="button" class="flex-center mr-auto"><div class="text-md mr-2"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M4 6h24v2H4zm0 18h24v2H4zm0-12h24v2H4zm0 6h24v2H4z"></path></svg></div><span class="text-sm">Menu</span></button><button type="button" class="flex-center ml-auto"><span class="text-sm">目录</span><div class="text-md mr-2" style="transform:rotate(0deg);transition:transform 0.2s ease-out;margin-top:2px"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></button><div class="rspress-local-toc-container "><ul><li><a href="#修改-ramn-固件" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">修改 RAMN 固件</span></a></li><li><a href="#刷新-ramn-固件" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">刷新 RAMN 固件</span></a></li><li><a href="#调试-ramn-固件" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">调试 RAMN 固件</span></a></li><li><a href="#配置固件ramn_configh" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">配置固件（ramn_config.h）</span></a></li><li><a href="#can-流量的简单修改标识符周期等" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">CAN 流量的简单修改（标识符、周期等）</span></a></li><li><a href="#升级到-can-fd" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">升级到 CAN-FD</span></a></li><li><a href="#can-流量的高级修改有效载荷格式等" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">CAN 流量的高级修改（有效载荷格式等）</span></a></li><li><a href="#修改-can-滤波器或波特率" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">修改 CAN 滤波器或波特率</span></a></li><li><a href="#修改-uds-接口" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">修改 UDS 接口</span></a></li><li><a href="#添加新内容" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">添加新内容</span></a></li><li><a href="#示例每秒发送一条-can-报文" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">示例：每秒发送一条 CAN 报文</span></a></li><li><a href="#示例在接收到特定-can-报文时执行某些操作" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">示例：在接收到特定 CAN 报文时执行某些操作</span></a></li><li><a href="#示例根据-ramn-控件做出决策" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">示例：根据 RAMN 控件做出决策</span></a></li><li><a href="#自定义-ecu-a-的显示" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">自定义 ECU A 的显示</span></a></li><li><a href="#在闪存中保存数据" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">在闪存中保存数据</span></a></li><li><a href="#修改ioc-文件" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">修改.ioc 文件</span></a></li><li><a href="#系统与外设设置" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">系统与外设设置</span></a></li><li><a href="#freertos-设置" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">FreeRTOS 设置</span></a></li><li><a href="#时钟设置" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">时钟设置</span></a></li><li><a href="#链接器设置" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">链接器设置</span></a></li><li><a href="#其他工具" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">其他工具</span></a></li><li><a href="#优化性能" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">优化性能</span></a></li><li><a href="#编译器优化" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">编译器优化</span></a></li><li><a href="#freertos-运行时统计信息" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">FreeRTOS 运行时统计信息</span></a></li><li><a href="#理解-ramn-的内存" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">理解 RAMN 的内存</span></a></li><li><a href="#理解-ramn-的安全特性" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">理解 RAMN 的安全特性</span></a></li><li><a href="#加固" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">加固</span></a></li><li><a href="#内存保护" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">内存保护</span></a></li><li><a href="#唯一硬件种子" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">唯一硬件种子</span></a></li><li><a href="#额外的安全功能trustzone-等" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">额外的安全功能（TrustZone 等）</span></a></li><li><a href="#探索-ramn-的安全性" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">探索 RAMN 的安全性</span></a></li><li><a href="#在-ghidra-中分析-ramn-固件" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">在 Ghidra 中分析 RAMN 固件</span></a></li><li><a href="#为-ramn-编写-arm-shellcode" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">为 RAMN 编写 ARM shellcode</span></a></li><li><a href="#使用-openocd-进行调试" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">使用 OpenOCD 进行调试</span></a></li><li><a href="#典型项目指导" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">典型项目指导</span></a></li><li><a href="#为ctf或类似活动准备-ramn" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">为CTF（或类似活动）准备 RAMN</span></a></li><li><a href="#实现安全的-can-总线secoc-等" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">实现安全的 CAN 总线（SecOC 等）</span></a></li><li><a href="#实现自定义引导程序ota安全启动等" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">实现自定义引导程序（OTA、安全启动等）</span></a></li><li><a href="#实现漏洞" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">实现漏洞</span></a></li><li><a href="#创建新扩展" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">创建新扩展</span></a></li><li><a href="#uart" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">UART</span></a></li><li><a href="#i2c" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">I2C</span></a></li><li><a href="#spi" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">SPI</span></a></li><li><a href="#模数转换器adc" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">模数转换器（ADC）</span></a></li><li><a href="#定时器pwm" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">定时器（PWM）</span></a></li><li><a href="#gpio-与中断" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:24px"><span class="rspress-toc-link-text block">GPIO 与中断</span></a></li><li><a href="#freertos-通用提示" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">FreeRTOS 通用提示</span></a></li><li><a href="#局限性" class="link_a7cea rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">局限性</span></a></li></ul></div></div></div><div class="content_ff766 rspress-doc-container flex"><div class="flex-1 overflow-x-auto"><div class="rspress-doc"><!--$--><h1 id="自定义指南" class="rspress-doc-title text-3xl mb-10 leading-10 tracking-tight title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#自定义指南">#</a>自定义指南</h1>
<p class="my-4 leading-7">本页面包含有关如何自定义 RAMN 的信息，以及实施某些项目（例如添加自定义引导加载程序、添加消息认证等）的指导。如果您想了解默认固件的功能，请查看<a href="/docs/quickstart.html#快速入门指南" class="link_a7cea  link_a9ef4 inline-link_f855c">快速入门指南</a>或<a href="/docs/userguide.html" class="link_a7cea  link_a9ef4 inline-link_f855c">用户指南</a>。</p>
<p class="my-4 leading-7"><strong class="font-semibold">摘要：</strong></p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">所有 ECU 共享同一份源代码，仅其配置有所不同（即 <code>#define TARGET_ECUA</code>、<code>#define TARGET_ECUB</code>、<code>#define TARGET_ECUC</code> 或 <code>#define TARGET_ECUD</code>）。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>ramn_config.h</code> 保存当前配置，<code>ramn_customize.c</code> 为常用函数提供钩子（例如，在接收到 CAN 消息时调用的函数）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">当您向网络中添加新的 CAN 标识符时，需要更新 CAN 滤波器（包括标准和扩展滤波器），或者完全禁用滤波器。</li>
<li class="[&amp;:not(:first-child)]:mt-2">CAN 外设已配置为 CAN-FD 模式，但仅使用经典 CAN 报文。您可以按照本页面的说明，将默认流量更改为 CAN-FD。</li>
<li class="[&amp;:not(:first-child)]:mt-2">您总共有 256kB 的 RAM，以及 256kB 或 512kB 的 Flash。如果内存不足，您可以减小 CAN 和 USB 缓冲区的大小，启用编译器优化，或者移除未使用的功能（在 <code>ramn_config.h</code> 中）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">如果您使用 STM32 代码生成（即，如果您修改了 <code>RAMNV1.ioc</code>），请务必小心，不要让它覆盖您自己的代码。</li>
</ul>
<p class="my-4 leading-7">RAMN 是一个基于 HAL 和 FreeRTOS、采用 STM32CubeIDE 开发的常规 STM32 项目，适用于 STM32L552 和 STM32L562 微控制器。如果您需要本页面未提供的信息，可以随时通过互联网搜索通用的 STM32、HAL 和 FreeRTOS 相关资源。</p>
<p class="my-4 leading-7"><strong class="font-semibold">内容：</strong></p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E4%BF%AE%E6%94%B9-ramn-%E5%9B%BA%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">修改 RAMN 固件</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%88%B7%E6%96%B0-ramn-%E5%9B%BA%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">刷写 RAMN 固件</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E8%B0%83%E8%AF%95-ramn-%E5%9B%BA%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">调试 RAMN 固件</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E9%85%8D%E7%BD%AE%E5%9B%BA%E4%BB%B6ramn_configh" class="link_a7cea  link_a9ef4 inline-link_f855c">配置固件 (ramn_config.h)</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#can-%E6%B5%81%E9%87%8F%E7%9A%84%E7%AE%80%E5%8D%95%E4%BF%AE%E6%94%B9%E6%A0%87%E8%AF%86%E7%AC%A6%E5%91%A8%E6%9C%9F%E7%AD%89" class="link_a7cea  link_a9ef4 inline-link_f855c">对 CAN 流量的简单修改（标识符、周期等）</a>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%8D%87%E7%BA%A7%E5%88%B0-can-fd" class="link_a7cea  link_a9ef4 inline-link_f855c">升级至 CAN-FD</a></li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%AF%B9-can-%E6%B5%81%E9%87%8F%E7%9A%84%E9%AB%98%E7%BA%A7%E4%BF%AE%E6%94%B9%E6%9C%89%E6%95%88%E8%BD%BD%E8%8D%B7%E6%A0%BC%E5%BC%8F%E7%AD%89" class="link_a7cea  link_a9ef4 inline-link_f855c">对 CAN 流量的高级修改（有效载荷格式等）</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E4%BF%AE%E6%94%B9-can-%E6%BB%A4%E6%B3%A2%E5%99%A8%E6%88%96%E6%B3%A2%E7%89%B9%E7%8E%87" class="link_a7cea  link_a9ef4 inline-link_f855c">修改 CAN 滤波器或波特率</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E4%BF%AE%E6%94%B9-uds-%E6%8E%A5%E5%8F%A3" class="link_a7cea  link_a9ef4 inline-link_f855c">修改 UDS 接口</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E6%B7%BB%E5%8A%A0%E6%96%B0%E5%86%85%E5%AE%B9" class="link_a7cea  link_a9ef4 inline-link_f855c">添加新内容</a>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E7%A4%BA%E4%BE%8B%E6%AF%8F%E7%A7%92%E5%8F%91%E9%80%81%E4%B8%80%E6%9D%A1-can-%E6%8A%A5%E6%96%87" class="link_a7cea  link_a9ef4 inline-link_f855c">示例：每秒发送一条 CAN 报文</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E7%A4%BA%E4%BE%8B%E5%9C%A8%E6%8E%A5%E6%94%B6%E5%88%B0%E7%89%B9%E5%AE%9A-can-%E6%8A%A5%E6%96%87%E6%97%B6%E6%89%A7%E8%A1%8C%E6%9F%90%E4%BA%9B%E6%93%8D%E4%BD%9C" class="link_a7cea  link_a9ef4 inline-link_f855c">示例：在接收到特定 CAN 报文时执行某些操作</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E7%A4%BA%E4%BE%8B%E6%A0%B9%E6%8D%AE-ramn-%E6%8E%A7%E4%BB%B6%E5%81%9A%E5%87%BA%E5%86%B3%E7%AD%96" class="link_a7cea  link_a9ef4 inline-link_f855c">示例：基于 RAMN 控制做出决策</a></li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89-ecu-a-%E7%9A%84%E6%98%BE%E7%A4%BA" class="link_a7cea  link_a9ef4 inline-link_f855c">自定义 ECU A 的显示</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%9C%A8%E9%97%AA%E5%AD%98%E4%B8%AD%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE" class="link_a7cea  link_a9ef4 inline-link_f855c">在闪存中保存数据</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E4%BF%AE%E6%94%B9ioc-%E6%96%87%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">修改.ioc 文件</a>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E7%B3%BB%E7%BB%9F%E4%B8%8E%E5%A4%96%E8%AE%BE%E8%AE%BE%E7%BD%AE" class="link_a7cea  link_a9ef4 inline-link_f855c">系统与外设设置</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#freertos-%E8%AE%BE%E7%BD%AE" class="link_a7cea  link_a9ef4 inline-link_f855c">FreeRTOS 设置</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E6%97%B6%E9%92%9F%E8%AE%BE%E7%BD%AE" class="link_a7cea  link_a9ef4 inline-link_f855c">时钟设置</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E9%93%BE%E6%8E%A5%E5%99%A8%E8%AE%BE%E7%BD%AE" class="link_a7cea  link_a9ef4 inline-link_f855c">链接器设置</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7" class="link_a7cea  link_a9ef4 inline-link_f855c">其他工具</a></li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E4%BC%98%E5%8C%96%E6%80%A7%E8%83%BD" class="link_a7cea  link_a9ef4 inline-link_f855c">优化性能</a>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E7%BC%96%E8%AF%91%E5%99%A8%E4%BC%98%E5%8C%96" class="link_a7cea  link_a9ef4 inline-link_f855c">编译器优化</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#freertos-%E8%BF%90%E8%A1%8C%E6%97%B6%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF" class="link_a7cea  link_a9ef4 inline-link_f855c">FreeRTOS 运行时统计信息</a></li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E7%90%86%E8%A7%A3-ramn-%E7%9A%84%E5%86%85%E5%AD%98" class="link_a7cea  link_a9ef4 inline-link_f855c">理解 RAMN 的内存</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E7%90%86%E8%A7%A3-ramn-%E7%9A%84%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7" class="link_a7cea  link_a9ef4 inline-link_f855c">理解 RAMN 的安全特性</a>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%8A%A0%E5%9B%BA" class="link_a7cea  link_a9ef4 inline-link_f855c">加固</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%86%85%E5%AD%98%E4%BF%9D%E6%8A%A4" class="link_a7cea  link_a9ef4 inline-link_f855c">内存保护</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%94%AF%E4%B8%80%E7%A1%AC%E4%BB%B6%E7%A7%8D%E5%AD%90" class="link_a7cea  link_a9ef4 inline-link_f855c">唯一硬件种子</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E9%A2%9D%E5%A4%96%E7%9A%84%E5%AE%89%E5%85%A8%E5%8A%9F%E8%83%BDtrustzone-%E7%AD%89" class="link_a7cea  link_a9ef4 inline-link_f855c">额外的安全功能（TrustZone 等）</a></li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E6%8E%A2%E7%B4%A2-ramn-%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7" class="link_a7cea  link_a9ef4 inline-link_f855c">探索 RAMN 的安全性</a>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%9C%A8-ghidra-%E4%B8%AD%E5%88%86%E6%9E%90-ramn-%E5%9B%BA%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">在 Ghidra 中分析 RAMN 固件</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E4%B8%BA-ramn-%E7%BC%96%E5%86%99-arm-shellcode" class="link_a7cea  link_a9ef4 inline-link_f855c">为 RAMN 编写 ARM Shellcode</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E4%BD%BF%E7%94%A8-openocd-%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95" class="link_a7cea  link_a9ef4 inline-link_f855c">使用 OpenOCD 进行调试</a></li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%85%B8%E5%9E%8B%E9%A1%B9%E7%9B%AE%E6%8C%87%E5%AF%BC" class="link_a7cea  link_a9ef4 inline-link_f855c">典型项目指导</a>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E4%B8%BActf%E6%88%96%E7%B1%BB%E4%BC%BC%E6%B4%BB%E5%8A%A8%E5%87%86%E5%A4%87-ramn" class="link_a7cea  link_a9ef4 inline-link_f855c">为CTF（或类似活动）准备 RAMN</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%AE%9E%E7%8E%B0%E5%AE%89%E5%85%A8%E7%9A%84-can-%E6%80%BB%E7%BA%BFsecoc-%E7%AD%89" class="link_a7cea  link_a9ef4 inline-link_f855c">实现安全的 CAN 总线（SecOC 等）</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8Fota%E5%AE%89%E5%85%A8%E5%90%AF%E5%8A%A8%E7%AD%89" class="link_a7cea  link_a9ef4 inline-link_f855c">实现自定义引导程序（OTA、安全启动等）</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%AE%9E%E7%8E%B0%E6%BC%8F%E6%B4%9E" class="link_a7cea  link_a9ef4 inline-link_f855c">实现漏洞</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E6%89%A9%E5%B1%95" class="link_a7cea  link_a9ef4 inline-link_f855c">创建新扩展</a>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#uart" class="link_a7cea  link_a9ef4 inline-link_f855c">UART</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#i2c" class="link_a7cea  link_a9ef4 inline-link_f855c">I2C</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#spi" class="link_a7cea  link_a9ef4 inline-link_f855c">SPI</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E6%A8%A1%E6%95%B0%E8%BD%AC%E6%8D%A2%E5%99%A8adc" class="link_a7cea  link_a9ef4 inline-link_f855c">模数转换器（ADC）</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%AE%9A%E6%97%B6%E5%99%A8pwm" class="link_a7cea  link_a9ef4 inline-link_f855c">定时器（PWM）</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#gpio-%E4%B8%8E%E4%B8%AD%E6%96%AD" class="link_a7cea  link_a9ef4 inline-link_f855c">GPIO 与中断</a></li>
</ul>
</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#freertos-%E9%80%9A%E7%94%A8%E6%8F%90%E7%A4%BA" class="link_a7cea  link_a9ef4 inline-link_f855c">FreeRTOS 通用提示</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%B1%80%E9%99%90%E6%80%A7" class="link_a7cea  link_a9ef4 inline-link_f855c">局限性</a></li>
</ul>
<h2 id="修改-ramn-固件" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#修改-ramn-固件">#</a>修改 RAMN 固件</h2>
<p class="my-4 leading-7">RAMN 固件是使用 GCC 工具链构建的。虽然您可以自由选择任何喜欢的 IDE，但建议您从意法半导体的网站上安装最新版本的 <a href="https://www.st.com/en/development-tools/stm32cubeide.html" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">STM32CubeIDE</a>。</p>
<p class="my-4 leading-7">您可以从 <a href="https://github.com/ToyotaInfoTech/RAMN" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">GitHub 仓库</a>下载 RAMN 的源代码（点击“Code”然后“Download ZIP”）。源代码位于 <em>firmware/RAMNV1</em> 文件夹中。</p>
<p class="my-4 leading-7">安装 STM32CubeIDE 后，打开它，创建或打开一个工作区，然后依次选择“File” &gt; “Import…” &gt; “Existing Projects into Workspace”，接着选择 <em>firmware/RAMNV1</em> 所在的路径。点击“Next”，然后使用默认设置导入项目，点击“Finish”。</p>
<p class="my-4 leading-7">这样，RAMN 项目就会出现在您的工作区中。所有 ECU 的源代码是相同的：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">ECU A 固件是通过设置 <code>TARGET_ECUA</code> 标志位构建的。</li>
<li class="[&amp;:not(:first-child)]:mt-2">ECU B 固件是通过设置 <code>TARGET_ECUB</code> 标志位构建的。</li>
<li class="[&amp;:not(:first-child)]:mt-2">ECU C 固件是通过设置 <code>TARGET_ECUC</code> 标志位构建的。</li>
<li class="[&amp;:not(:first-child)]:mt-2">ECU D 固件是使用 <code>TARGET_ECUD</code> 标志构建的。</li>
</ul>
<p class="my-4 leading-7">您可以通过修改 <code>ramn_config.h</code>,并将 <code>#define TARGET_ECUA</code> 替换为您所需的目标，来更改默认的目标 ECU。</p>
<p class="my-4 leading-7"><strong class="font-semibold">当您修改源代码时，这些修改将应用于所有 ECU</strong>。要编写特定于单个 ECU 的代码，请在其周围使用 <code>#ifdef</code> 和 <code>endif</code> 预处理器指令。例如，要仅将修改应用于 ECU A：</p>
<div class="language-c++"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-c++" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">1</span><span>#ifdef TARGET_ECUA
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">2</span>// Code executed by ECU A
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">3</span>#else
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">4</span>// Code executed by ECU B, C, and D
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">5</span>#endif</span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">或者，你也可以维护四份独立的源代码副本，使每个 ECU 拥有自己独立的源代码，从而降低意外修改的风险。</p>
<p class="my-4 leading-7">要为在 <code>ramn_config.h</code> 中定义的默认目标 ECU 构建固件，请选择“项目”&gt;“构建项目”，或按下锤子图标。固件二进制文件（.elf、.bin、.hex）以及调试信息文件（.list、.map）将位于 <em>RAMNV1/Debug</em> 文件夹中。</p>
<p class="my-4 leading-7">实用快捷键：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">使用 <strong class="font-semibold">Control+H</strong> 搜索字符串（例如，本页面中提到的变量和函数）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">使用 <strong class="font-semibold">Control+Tab</strong> 在源文件和头文件之间切换。</li>
<li class="[&amp;:not(:first-child)]:mt-2">按住 <strong class="font-semibold">Control</strong> 并单击函数名以跳转到其定义。</li>
<li class="[&amp;:not(:first-child)]:mt-2">按 <strong class="font-semibold">Alt+Left</strong> 返回。</li>
<li class="[&amp;:not(:first-child)]:mt-2">要查找变量或函数的使用位置，右键单击该变量或函数，然后选择 <strong class="font-semibold">“引用”</strong> &gt; <strong class="font-semibold">“项目”</strong>。</li>
</ul>
<div class="rspress-directive warning"><div class="rspress-directive-title">警告</div><div class="rspress-directive-content"><p class="my-4 leading-7">在更改目标 ECU 时，STM32CubeIDE 可能需要一些时间来更新引用，并且在搜索项目时可能会遇到问题。为避免此问题，在更改目标 ECU 后，应选择 <strong class="font-semibold">“项目”</strong> &gt; <strong class="font-semibold">“C/C++索引”</strong> &gt; <strong class="font-semibold">“重建”</strong>。</p></div></div>
<p class="my-4 leading-7">要一次性为所有 ECU 构建固件，可以使用 <em>scripts/build</em> 文件夹中的构建脚本（请确保首先关闭 STM32CubeIDE）。 <strong class="font-semibold">您可能需要在构建脚本（.bat 或.sh 文件）中更新 STM32CUBEIDEPATH，以匹配您的安装路径</strong> 。</p>
<p class="my-4 leading-7"><code>BUILD_Clean_Debug.bat</code> 将为所有四个 ECU 构建固件，并将新的固件文件放置在 <em>scripts/firmware</em> 文件夹中。</p>
<div class="rspress-directive warning"><div class="rspress-directive-title">警告</div><div class="rspress-directive-content"><p class="my-4 leading-7">默认 RAMN 已优化，以使用大部分可用内存。如果您的应用程序需要大量内存，可能会遇到以下情况：</p><ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">构建项目时出现“ <strong class="font-semibold">区域 XX 溢出 YY 字节</strong> ”错误。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>calloc</code> 返回 NULL。</li>
<li class="[&amp;:not(:first-child)]:mt-2">FreeRTOS 任务中的堆栈溢出。</li>
</ul><p class="my-4 leading-7">您可以通过减小 USB 和 CAN 缓冲区的大小，轻松为您的应用程序释放内存。请阅读 <a href="#%E7%90%86%E8%A7%A3-ramn-%E7%9A%84%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7" class="link_a7cea  link_a9ef4 inline-link_f855c">理解 RAMN 的安全特性</a>部分，以了解如何为您的应用程序释放更多内存。</p></div></div>
<div class="rspress-directive info"><div class="rspress-directive-title">注意</div><div class="rspress-directive-content"><p class="my-4 leading-7">默认情况下，RAMN 已配置为支持内存保护。如果您的应用程序需要严格的内存保护（例如，您希望将 RAMN 用于“夺旗”比赛，参赛者不得转储内存），请阅读 <a href="#%E7%90%86%E8%A7%A3-ramn-%E7%9A%84%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7" class="link_a7cea  link_a9ef4 inline-link_f855c">理解 RAMN 的安全特性</a>部分。</p><p class="my-4 leading-7">如果内存保护不是问题（例如，您将 RAMN 用作研究或教育平台），您可以将 <code>STM32L552CETX_FLASH.ld</code> 的内容替换为 <code>STM32L552CETX_FLASH_INSECURE.ld</code> （位于 <em>RAMNV1</em> 文件夹中）的内容，从而为您的应用程序释放更多内存。</p></div></div>
<h2 id="刷新-ramn-固件" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#刷新-ramn-固件">#</a>刷新 RAMN 固件</h2>
<p class="my-4 leading-7">有许多接口可用于刷写新的固件。其中最快且最易用的是 STM32 嵌入式引导加载程序接口（可通过 USB 使用 DFU 对 ECU A 进行重新编程，也可通过 ECU A 经由 CAN-FD 对 ECU B/C/D 进行重新编程）。</p>
<p class="my-4 leading-7">位于 scripts/STbootloader/windows 中的脚本 <code>ProgramECU_A.bat</code> 和 <code>ProgramECU_BCD.bat</code> 可用于刷新位于 scripts/firmware 文件夹中的固件.hex 文件（<code>ECUA.hex</code>、<code>ECUB.hex</code>、<code>ECUC.hex</code> 和 <code>ECUD.hex</code>)。</p>
<p class="my-4 leading-7">有关更多详细信息，请参阅<a href="/docs/hardware/flashing.html#刷写脚本" class="link_a7cea  link_a9ef4 inline-link_f855c">刷写脚本</a>。</p>
<h2 id="调试-ramn-固件" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#调试-ramn-固件">#</a>调试 RAMN 固件</h2>
<p class="my-4 leading-7">要调试 RAMN ECU 的源代码，您需要购买一个外部 JTAG 调试器，并将其连接到您想要调试的 ECU。详细信息请参阅 <a href="/docs/hardware/flashing.html#jtag-硬件接口" class="link_a7cea  link_a9ef4 inline-link_f855c">JTAG 硬件接口</a>部分（STM32CubeIDE 也可以为 ECU 刷写程序，因此您无需使用STM32CubeProgrammer）。</p>
<p class="my-4 leading-7">首先，请确保您已在 <code>ramn_config.h</code> 中定义了您想要调试的目标 ECU。将调试器连接到该 ECU，然后在 STM32CubeIDE 中点击绿色的虫子图标（或选择“运行”&gt;“调试”）。如果这是您首次运行调试器，可能会出现提示窗口，此时应保持默认设置。</p>
<p class="my-4 leading-7">如果调试失败（或不可靠），请尝试删除 <code>RAMNV1 Debug.cfg</code> 和 <code>RAMNV1 Debug.launch</code>,以强制创建一个新的调试配置。然后，选择“运行”&gt;“调试配置…”，切换到“调试器”选项卡，并尝试不同的设置（可尝试不同的“调试探针”设置，同时测试 SWD 和 JTAG）。此外，请确保在<strong class="font-semibold">主</strong>选项卡中的 <strong class="font-semibold">C/C++应用程序</strong>指向当前配置的.elf 文件（通常为 <code>Debug/RAMNV1.elf</code>）。您可使用“搜索项目…”按钮来定位正确的二进制文件。</p>
<p class="my-4 leading-7">如果可能，建议启用 RTOS 内核感知功能（启用“RTOS 代理”，驱动程序：“FreeRTOS”，端口：“ARM_CM33_NTZ”），以获取更多调试信息；但如果遇到调试问题，则应将其关闭。</p>
<p class="my-4 leading-7">STM32CubeIDE 在调试过程中会自动通过 JTAG 重新刷新连接的 ECU。然而，它无法刷新其他 ECU。如果您的修改会影响所有 ECU（例如更改 CAN 波特率），则需要使用刷写脚本，以确保所有 ECU 都能应用您的修改。</p>
<h2 id="配置固件ramn_configh" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#配置固件ramn_configh">#</a>配置固件（ramn_config.h）</h2>
<p class="my-4 leading-7">您可以通过编辑 Core/Inc 文件夹中的 <code>ramn_config.h</code> 来配置固件。</p>
<p class="my-4 leading-7">如前所述，该文件用于定义在 STM32CubeIDE 中用于调试或构建固件的目标 ECU。</p>
<p class="my-4 leading-7">请阅读 <code>ramn_config.h</code> 中的注释，并根据您的需求调整设置。关键配置选项包括：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><code>ENABLE_USB_DEBUG</code>：通过 USB 启用额外的调试输出（例如，人类可读的 CAN 错误）。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>LED_TEST_DURATION_MS</code>：设置为 0 以在启动时跳过 ECU D 的 LED 测试。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>WATCHDOG_ENABLE</code>：启用看门狗定时器，以便在主周期性任务崩溃时重置 RAMN。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>AUTO_RECOVER_BUSOFF</code>：如果 ECU 进入总线关闭模式，则重置 CAN/CAN-FD 外设。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>HANG_ON_ERRORS</code>：在某些非关键错误发生时强制进入无限循环（而不是忽略这些错误）。</li>
</ul>
<p class="my-4 leading-7">您可能还需要调整超时值，例如 <code>ISOTP_TX_TIMEOUT_MS</code> 或 <code>UDS_SESSION_TIMEOUT_MS</code>,以匹配实际条件或使 ECU 更易于交互。例如，<code>UDS_SESSION_TIMEOUT_MS</code> 被设置为 <code>5000</code>,这会强制 ECU 在扩展诊断会话期间超过 5 秒未收到请求时恢复到 UDS 默认会话。如果您增大此值，用户将更容易进行 UDS 实验，但这将不再代表真实 ECU 的行为（真实 ECU 需要定期发送“测试器存在”请求）。</p>
<h2 id="can-流量的简单修改标识符周期等" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#can-流量的简单修改标识符周期等">#</a>CAN 流量的简单修改（标识符、周期等）</h2>
<p class="my-4 leading-7">RAMN 通常使用两种类型的 CAN 报文：“命令”和“控制”。命令报文由外部 ECU/计算机发送，用于请求 ECU 将其执行器设置为特定值（例如，CARLA 可利用此方式请求 ECU C 加速）。控制报文则报告所应用控制的实际值（例如，ECU C 实际施加的油门位置）。</p>
<p class="my-4 leading-7">例如，如果 CARLA 希望车辆施加 100%的油门值，它可以使用油门命令报文向 ECU C 发送请求。ECU C 可能会根据该报文决定施加 100%的油门。然而，如果 ECU C 检测到当前车速超过某一阈值或制动踏板被踩下，它可以选择忽略该命令，转而施加 0%的油门。这种方法可用于实现各种闭环控制算法（例如，实现 <a href="https://github.com/ToyotaInfoTech/RAMN/blob/main/misc/PID_example.pdf" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">PID 和 bang-bang 控制器</a>）。</p>
<p class="my-4 leading-7">您可以修改 <code>ramn_vehicle_specific.h</code> 以更新 RAMN 的 CAN 流量的基本属性。例如，如果您希望使用 ID 0x25 而不是 0x24 来表示制动消息，请将 <code>CAN_SIM_CONTROL_BRAKE_CANID</code> 从 <code>0x24</code> 更改为 <code>0x25</code>。</p>
<h3 id="升级到-can-fd" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#升级到-can-fd">#</a>升级到 CAN-FD</h3>
<p class="my-4 leading-7">您可以通过修改 <code>ramn_vehicle_specific.h</code> 从 CAN 升级到 CAN-FD：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">将 <code>CAN_MAX_PAYLOAD_SIZE_DEFAULT</code> 更改为 <code>64</code>（以启用 64 字节的有效载荷）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">将 <code>CAN_SIM_FORMAT_DEFAULT</code> 更改为 <code>FDCAN_FD_CAN</code>。</li>
<li class="[&amp;:not(:first-child)]:mt-2">将 <code>CAN_SIM_BRS_DEFAULT</code> 更改为 <code>FDCAN_BRS_ON</code>（如果您希望启用比特率切换）。</li>
</ul>
<div class="rspress-directive warning"><div class="rspress-directive-title">警告</div><div class="rspress-directive-content"><p class="my-4 leading-7">更改 <code>CAN_MAX_PAYLOAD_SIZE_DEFAULT</code> 可能会在编译时导致 RAM 溢出错误。请阅读<a href="#%E7%90%86%E8%A7%A3-ramn-%E7%9A%84%E5%86%85%E5%AD%98" class="link_a7cea  link_a9ef4 inline-link_f855c">了解 RAMN 的内存</a>部分，以了解如何为您的应用程序释放更多内存。</p></div></div>
<div class="rspress-directive warning"><div class="rspress-directive-title">警告</div><div class="rspress-directive-content"><p class="my-4 leading-7">当您将默认流量更新为 CAN-FD 时，将失去与大多数 slcan 工具的兼容性。建议使用外部 CAN-FD 适配器。在 Linux 上，您可以使用 <em>scripts/vcand</em> 中的脚本，从 RAMN 的 slcan 接口生成一个虚拟的 CAN-FD 接口。</p></div></div>
<h2 id="can-流量的高级修改有效载荷格式等" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#can-流量的高级修改有效载荷格式等">#</a>CAN 流量的高级修改（有效载荷格式等）</h2>
<p class="my-4 leading-7"><code>ramn_dbc.c</code> 是一个用于维护传入 CAN/CAN-FD 消息最新值数据库的模块。这确保了所有 ECU 都能访问所有的 RAMN 控制，即使某个控制属于其他 ECU。例如，如果你想从 ECU A 获取 ECU C 操纵杆的状态，只需读取 <code>RAMN_DBC_Handle.joystick</code> 的值即可。</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">函数 <code>RAMN_ACTUATORS_ApplyControls</code> 位于 <code>ramn_actuators.c</code> 中，负责确定要设置到传出周期性 CAN/CAN-FD 消息中的有效载荷。</li>
<li class="[&amp;:not(:first-child)]:mt-2">函数 <code>RAMN_DBC_FormatDefaultPeriodicMessage</code> 位于 <code>ramn_dbc.c</code> 中，通过添加计数器和 CRC32 校验和来格式化消息。</li>
<li class="[&amp;:not(:first-child)]:mt-2">函数 <code>RAMN_DBC_Send</code> 实际用于发送 CAN 消息。</li>
<li class="[&amp;:not(:first-child)]:mt-2">函数 <code>RAMN_DBC_ProcessCANMessage</code> 在 RAMN_DBC 模块中解析并记录传入的 CAN 消息。</li>
</ul>
<p class="my-4 leading-7">如果希望某个 ECU 停止发送消息，只需注释掉对 <code>RAMN_DBC_Send</code> 的调用即可。有关自定义示例，请参阅<a href="#%E5%AE%9E%E7%8E%B0%E5%AE%89%E5%85%A8%E7%9A%84-can-%E6%80%BB%E7%BA%BFsecoc-%E7%AD%89" class="link_a7cea  link_a9ef4 inline-link_f855c">实现安全的 CAN 总线（SecOC 等）</a>。</p>
<div class="rspress-directive info"><div class="rspress-directive-title">注意</div><div class="rspress-directive-content"><p class="my-4 leading-7">ECU A 还使用 <code>RAMN_DBC_ProcessUSBBuffer</code> 将从 CARLA 接收到的 USB 数据转换为 CAN 消息。</p></div></div>
<h2 id="修改-can-滤波器或波特率" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#修改-can-滤波器或波特率">#</a>修改 CAN 滤波器或波特率</h2>
<p class="my-4 leading-7">如果您希望在流量规范中添加新的 CAN 消息（而不仅仅是修改现有消息），则必须确保新 CAN 标识符未被过滤。您可以通过以下方式实现：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">在 <code>ramn_config.h</code> 中注释掉 <code>USE_HARDWARE_CAN_FILTERS</code>。这将禁用硬件滤波器，从而略微增加 CPU 负载。</li>
<li class="[&amp;:not(:first-child)]:mt-2">或者，您也可以在 <code>ramn_canfd.c</code> 中的 <code>recvStdCANIDList</code> 和 <code>recvExtCANIDList</code> 中分别添加您的新标识符，以分别处理标准和扩展标识符。</li>
</ul>
<p class="my-4 leading-7">如果您希望修改默认的波特率，应按照<a href="#%E4%BF%AE%E6%94%B9ioc-%E6%96%87%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">修改 .ioc 文件</a>一节中的说明，在 RAMNV1.ioc 文件中修改 CAN/CAN-FD 外设设置。如果您不熟悉位定时，可参考<a href="/docs/userguide/can_tutorial.html#位定时" class="link_a7cea  link_a9ef4 inline-link_f855c">位定时</a>一节。此外，您也可以通过修改 <code>ramn_canfd.c</code> 中的 <code>FDCAN_Config</code>,在初始化外设之前调用 <code>RAMN_FDCAN_UpdateBaudrate</code>，并传入您所需的新的波特率，从而覆盖默认的标称波特率。</p>
<div class="rspress-directive info"><div class="rspress-directive-title">注意</div><div class="rspress-directive-content"><p class="my-4 leading-7">如果您只是临时更改波特率，则无需修改固件，只需使用 UDS（<a href="/docs/userguide/diag_tutorial.html#与-uds-交互" class="link_a7cea  link_a9ef4 inline-link_f855c"> 与 UDS 交互</a>）和 USB 命令（<a href="/docs/userguide/usb_tutorial.html#与-usb-交互" class="link_a7cea  link_a9ef4 inline-link_f855c"> 与 USB 交互</a>）即可。</p></div></div>
<h2 id="修改-uds-接口" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#修改-uds-接口">#</a>修改 UDS 接口</h2>
<p class="my-4 leading-7">如果您希望自定义 UDS 接口（无论是修改现有服务还是添加新服务），则需要更新 <code>ramn_uds.c</code> 文件。您应根据需要修改用于物理寻址的 <code>RAMN_UDS_ProcessDiagPayload</code> 和/或用于功能寻址的 <code>RAMN_UDS_ProcessDiagPayloadFunctional</code> 。请注意，根据标准规范，功能寻址仅适用于单帧消息。</p>
<p class="my-4 leading-7">如果需要在发送响应后执行您的代码（例如，因为 ECU 将复位或更改波特率，需先进行响应），请在处理函数中发送一个肯定响应，并在 <code>RAMN_UDS_PerformPostAnswerActions</code> 中执行实际操作。</p>
<h2 id="添加新内容" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#添加新内容">#</a>添加新内容</h2>
<p class="my-4 leading-7"><code>ramn_customize.c</code> 是一个模块，旨在更轻松地向 RAMN 添加自定义内容。如果您希望在不改变 RAMN 默认行为的前提下对其进行扩展，应使用此模块。在 <code>ramn_customize.c</code> 中提供了多种函数，允许您在不同任务中添加自己的代码。例如：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><code>RAMN_CUSTOM_Update</code> 由 RAMN 的主周期性任务每 10 毫秒调用一次（默认设置）。它与处理其他周期性操作的任务相同，例如发送 CAN 消息、更新屏幕或 LED。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>RAMN_CUSTOM_CustomTaskX</code> 函数由未使用的任务调用，与主周期性任务并行执行。它们可用于在主周期性任务的同时并行执行某些操作。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>RAMN_CUSTOM_ProcessRxCANMessage</code> 由 RAMN 的 CAN 接收任务在接收到新 CAN 消息时调用。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>RAMN_CUSTOM_ProcessCDCLine</code> 由 RAMN 的 USB 接收任务在通过 USB 串行 (CDC) 接收到新行时调用。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>RAMN_CUSTOM_TIM6ISR</code> 由一个周期性定时器调用（默认情况下，每秒一次）。这可用于执行某些需要精确计时的操作，且与 FreeRTOS 无关。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>RAMN_CUSTOM_ReceiveUART</code> 在接收到 UART 命令行时被调用。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>RAMN_CUSTOM_ReceiveI2C</code> 和 <code>RAMN_CUSTOM_PrepareTransmitDataI2C</code> 在接收到 I2C RX 或 TX 命令时被调用（RAMN ECU 处于 <strong class="font-semibold">设备</strong>模式）。</li>
</ul>
<p class="my-4 leading-7">您还可以使用 TIM16 来访问一个高精度的自由运行定时器，该定时器未被其他模块使用（参见 <code>ramn_customize.c</code> 中的注释）。您可以修改 TIM6 和 TIM16，而不会影响 RAMN 的功能。</p>
<p class="my-4 leading-7">阅读 <code>ramn_customize.c</code> 以获取示例，例如如何发送 CAN 消息。</p>
<div class="rspress-directive warning"><div class="rspress-directive-title">警告</div><div class="rspress-directive-content"><p class="my-4 leading-7"><strong class="font-semibold">SPI 函数（用于更新 ECU A 的屏幕）只能从同一任务中调用</strong> ,默认情况下，该任务是调用 <code>RAMN_CUSTOM_Update</code> 的主周期性任务。这是因为该任务会等待 SPI 模块发出传输完成的通知后再继续执行，但如果从其他任务调用，则该任务将无法收到通知。</p><p class="my-4 leading-7">如果希望从其他任务使用 SPI，需要更新对 <code>RAMN_SPI_Init</code> 或 <code>RAMN_SCREENMANAGER_Init</code> 的调用，使 SPI 模块改为向你的任务发送通知。</p></div></div>
<h3 id="示例每秒发送一条-can-报文" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#示例每秒发送一条-can-报文">#</a>示例：每秒发送一条 CAN 报文</h3>
<p class="my-4 leading-7">为了让 ECU B 每秒发送一条标准 ID 为 0x123、负载为八个 0x77 的经典 CAN 报文，您可以在 <code>RAMN_CUSTOM_Update</code> 中，在 “此处代码每 1 秒执行一次” 注释之后添加以下代码：</p>
<div class="language-c"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-c" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">1</span><span class="token macro directive-hash" style="color:var(--code-token-parameter)">#</span><span class="token macro directive" style="color:var(--code-token-keyword)">ifdef</span><span class="token macro" style="color:var(--code-token-parameter)"> </span><span class="token macro expression" style="color:var(--code-token-parameter)">TARGET_ECUB</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">2</span><span>FDCAN_TxHeaderTypeDef header</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">3</span><span></span><span class="token class-name">uint8_t</span><span> data</span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token number">8U</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">4</span>
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">5</span><span></span><span class="token" style="color:var(--code-token-comment)">// CAN message header content</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">6</span><span>header</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>BitRateSwitch </span><span class="token operator">=</span><span> FDCAN_BRS_OFF</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span> </span><span class="token" style="color:var(--code-token-comment)">// Bitrate switching OFF (only needed for CAN-FD, but set anyway); other option is FDCAN_BRS_ON.</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">7</span><span>header</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>ErrorStateIndicator </span><span class="token operator">=</span><span> FDCAN_ESI_ACTIVE</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span> </span><span class="token" style="color:var(--code-token-comment)">// ESI bit (for CAN-FD only, but set anyway); other option is FDCAN_ESI_PASSIVE.</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">8</span><span>header</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>FDFormat </span><span class="token operator">=</span><span> FDCAN_CLASSIC_CAN</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span> </span><span class="token" style="color:var(--code-token-comment)">// Classic CAN; other option is FDCAN_FD_CAN.</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">9</span><span>header</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>TxFrameType </span><span class="token operator">=</span><span> FDCAN_DATA_FRAME</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span> </span><span class="token" style="color:var(--code-token-comment)">// Data frame; other option is FDCAN_REMOTE_FRAME, only for classic CAN.</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">10</span><span>header</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>IdType </span><span class="token operator">=</span><span> FDCAN_STANDARD_ID</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span> </span><span class="token" style="color:var(--code-token-comment)">// Standard identifier; other option is FDCAN_EXTENDED_ID for extended.</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">11</span><span>header</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>Identifier </span><span class="token operator">=</span><span> </span><span class="token number">0x123</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span> </span><span class="token" style="color:var(--code-token-comment)">// Identifier.</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">12</span><span>header</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>DataLength </span><span class="token operator">=</span><span> </span><span class="token number">8U</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span> </span><span class="token" style="color:var(--code-token-comment)">// DLC (Payload size).</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">13</span>
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">14</span><span></span><span class="token" style="color:var(--code-token-comment)">// CAN message payload content</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">15</span><span></span><span class="token" style="color:var(--code-token-function)">RAMN_memset</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>data</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token number">0x77</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token number">8U</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span> </span><span class="token" style="color:var(--code-token-comment)">// write 0x77 8 times</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">16</span>
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">17</span><span></span><span class="token" style="color:var(--code-token-comment)">// Send message</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">18</span><span></span><span class="token" style="color:var(--code-token-function)">RAMN_FDCAN_SendMessage</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token operator">&amp;</span><span>header</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>data</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">19</span><span></span><span class="token macro directive-hash" style="color:var(--code-token-parameter)">#</span><span class="token macro directive" style="color:var(--code-token-keyword)">endif</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<h3 id="示例在接收到特定-can-报文时执行某些操作" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#示例在接收到特定-can-报文时执行某些操作">#</a>示例：在接收到特定 CAN 报文时执行某些操作</h3>
<p class="my-4 leading-7">为了让 ECU C 在接收到上述 CAN 报文时执行某些操作，您可以在 <code>RAMN_CUSTOM_ProcessRxCANMessage</code> 中添加以下代码：</p>
<div class="language-c"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-c" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">1</span><span class="token macro directive-hash" style="color:var(--code-token-parameter)">#</span><span class="token macro directive" style="color:var(--code-token-keyword)">ifdef</span><span class="token macro" style="color:var(--code-token-parameter)"> </span><span class="token macro expression" style="color:var(--code-token-parameter)">TARGET_ECUC</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">2</span><span></span><span class="token" style="color:var(--code-token-comment)">// Fields that you may want to use:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">3</span><span></span><span class="token" style="color:var(--code-token-comment)">// pHeader-&gt;Identifier: (11-bit val for standard, 29-bit for extended)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">4</span><span></span><span class="token" style="color:var(--code-token-comment)">// pHeader-&gt;IdType: FDCAN_STANDARD_ID or FDCAN_EXTENDED_ID</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">5</span><span></span><span class="token" style="color:var(--code-token-comment)">// pHeader-&gt;RxFrameType:  FDCAN_DATA_FRAME or FDCAN_REMOTE_FRAME</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">6</span><span></span><span class="token" style="color:var(--code-token-comment)">// DataLength: length of CAN payload, FDCAN_DLC_BYTES_0 (0) to FDCAN_DLC_BYTES_8 (8) for CAN, FDCAN_DLC_BYTES_0 (0) to FDCAN_DLC_BYTES_64 (0xF, Not 64) for CAN-FD.</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">7</span><span></span><span class="token" style="color:var(--code-token-comment)">// pHeader-&gt;ErrorStateIndicator: For CAN-FD, either FDCAN_ESI_ACTIVE or FDCAN_ESI_PASSIVE</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">8</span><span></span><span class="token" style="color:var(--code-token-comment)">// pHeader-&gt;BitRateSwitch: For CAN-FD, either FDCAN_BRS_OFF or FDCAN_BRS_ON</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">9</span><span></span><span class="token" style="color:var(--code-token-comment)">// pHeader-&gt;FDFormat: FDCAN_CLASSIC_CAN or FDCAN_FD_CAN</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">10</span>
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">11</span><span></span><span class="token" style="color:var(--code-token-comment)">// Add or remove checks as needed.</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">12</span><span></span><span class="token" style="color:var(--code-token-keyword)">if</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>pHeader</span><span class="token operator">-&gt;</span><span>FDFormat </span><span class="token operator">==</span><span> FDCAN_CLASSIC_CAN</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token operator">&amp;&amp;</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>pHeader</span><span class="token operator">-&gt;</span><span>Identifier </span><span class="token operator">==</span><span> </span><span class="token number">0x123</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token operator">&amp;&amp;</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>pHeader</span><span class="token operator">-&gt;</span><span>RxFrameType </span><span class="token operator">==</span><span> FDCAN_DATA_FRAME</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token operator">&amp;&amp;</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>pHeader</span><span class="token operator">-&gt;</span><span>IdType </span><span class="token operator">==</span><span> FDCAN_STANDARD_ID</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">13</span><span></span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">14</span><span>        </span><span class="token" style="color:var(--code-token-comment)">/* Code executed by ECU C on reception of this specific CAN message */</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">15</span><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">16</span><span></span><span class="token macro directive-hash" style="color:var(--code-token-parameter)">#</span><span class="token macro directive" style="color:var(--code-token-keyword)">endif</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">独立地，您必须确保 ECU C 不会过滤 CAN 消息。请在 <code>ramn_config.h</code> 中取消定义 <code>USE_HARDWARE_CAN_FILTERS</code>,或者将该标识符添加到 <code>ramn_canfd.c</code> 中的 <code>recvStdCANIDList</code>：</p>
<div class="language-c"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-c" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">1</span><span class="token" style="color:var(--code-token-keyword)">static</span><span> </span><span class="token" style="color:var(--code-token-keyword)">const</span><span> </span><span class="token class-name">uint16_t</span><span> recvStdCANIDList</span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span> </span><span class="token operator">=</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">2</span><span></span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">3</span>
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">4</span><span></span><span class="token" style="color:var(--code-token-comment)">/* List of standard IDs received by ECU */</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">5</span>
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">6</span><span></span><span class="token" style="color:var(--code-token-comment)">/* ... */</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">7</span>
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">8</span><span></span><span class="token macro directive-hash" style="color:var(--code-token-parameter)">#</span><span class="token macro directive" style="color:var(--code-token-keyword)">ifdef</span><span class="token macro" style="color:var(--code-token-parameter)"> </span><span class="token macro expression" style="color:var(--code-token-parameter)">TARGET_ECUC</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">9</span><span>        </span><span class="token number">0x123</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">10</span><span></span><span class="token macro directive-hash" style="color:var(--code-token-parameter)">#</span><span class="token macro directive" style="color:var(--code-token-keyword)">endif</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">11</span><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">;</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<h3 id="示例根据-ramn-控件做出决策" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#示例根据-ramn-控件做出决策">#</a>示例：根据 RAMN 控件做出决策</h3>
<p class="my-4 leading-7">您可以使用以下方式读取当前 RAMN 控件的值：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">如果 ECU 具有物理访问权限（例如，用于换挡操纵杆的 ECU C），则使用 <code>ramn_sensors.h</code> 中的变量。</li>
<li class="[&amp;:not(:first-child)]:mt-2">如果 ECU 没有物理访问权限（例如，用于换挡操纵杆的 ECU A、B 和 D），则使用 <code>ramn_dbc.h</code> 中的变量。</li>
</ul>
<p class="my-4 leading-7">例如，如果您希望与换挡操纵杆物理连接的 ECU C 仅在操纵杆释放时执行代码，您可以添加以下条件：</p>
<div class="language-c"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-c" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">1</span><span class="token" style="color:var(--code-token-keyword)">if</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>RAMN_SENSORS_POWERTRAIN</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>shiftJoystick </span><span class="token operator">==</span><span> RAMN_SHIFT_RELEASED</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">2</span><span></span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">3</span><span>        </span><span class="token" style="color:var(--code-token-comment)">// Your code</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">4</span><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">如果希望将相同的条件应用于其他 ECU（ECU A、B 或 D），您可以添加以下条件：</p>
<div class="language-c"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-c" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">1</span><span class="token" style="color:var(--code-token-keyword)">if</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>RAMN_DBC_Handle</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>joystick </span><span class="token operator">==</span><span> RAMN_SHIFT_RELEASED</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">2</span><span></span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">3</span><span>        </span><span class="token" style="color:var(--code-token-comment)">// Your code</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">4</span><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<div class="rspress-directive info"><div class="rspress-directive-title">注意</div><div class="rspress-directive-content"><ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">对于第一种情况，ECU 的决策依据是<strong class="font-semibold">物理传感器</strong> 。即使用户通过发送 CAN 操纵杆消息来伪造 CAN 总线，ECU C 也不会做出反应（因为 ECU C 的决策基于物理传感器）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">对于第二种情况，ECU 的决策依据是<strong class="font-semibold">最新的相关 CAN 消息</strong> 。如果您尚未实施 CAN 总线保护措施，用户便可通过伪造操纵杆 CAN 消息来绕过控制。</li>
</ul></div></div>
<h2 id="自定义-ecu-a-的显示" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#自定义-ecu-a-的显示">#</a>自定义 ECU A 的显示</h2>
<p class="my-4 leading-7"><code>ramn_screen_manager.c</code> 是一个用于处理 ECU A 显示的模块，允许用户通过按下操纵杆上的左右键在不同屏幕之间切换。</p>
<p class="my-4 leading-7">如果需要修改可用屏幕以及启动后加载的默认屏幕，请修改 <code>screens</code> 和 <code>DEFAULT_SCREEN</code> 在 <code>ramn_screen_manager.c</code> 和 <code>ramn_screen_manager.h</code> 中的内容。</p>
<p class="my-4 leading-7">如果您想添加一个新的自定义屏幕，需要在代码中创建一个包含函数指针（例如：Init、DeInit、Update 等）的 <code>RAMNScreen_t</code> 结构。建议您创建一个新的模块（.c 和 .h 文件），并模仿 <code>ramn_screen_saver.c</code> 和 <code>ramn_screen_saver.h</code> 的内容，这两个文件展示了一个能够读取输入并更新屏幕的简单屏幕示例。只需复制粘贴这些文件的内容，并将其中的“screensaver”和“screen_saver”字符串替换为您新屏幕的名称。然后，修改这些文件以实现您期望的行为，并将您的结构添加到 <code>screens</code> 数组中，该数组位于 <code>ramn_screen_manager.c</code> 文件中。</p>
<p class="my-4 leading-7">如果要显示图像，可以使用 misc 文件夹中的 <code>image_to_C.py</code> 脚本，将图像文件转换为可添加到.c 文件中的源代码（RGB565 数组）。然后，使用 <code>RAMN_SPI_DrawImage</code> 函数并传入您的图像以进行显示（建议在仅调用一次的 Init 函数中执行，而不是在周期性调用的 Update 函数中执行）。ECU A 的显示屏尺寸为 240x240。“内部屏幕”的尺寸为 236x195（起始偏移量为 x=2，y=2）。</p>
<p class="my-4 leading-7">您可以使用 <code>RAMN_SPI_SetScroll</code> 或 <code>RAMN_SPI_ScrollUp</code> 来滚动显示屏（包括图像）。根据您希望滚动的显示区域大小，您可能需要在 Init 阶段调用 <code>RAMN_SCREENUTILS_PrepareScrollScreen()</code> ，并在 DeInit 阶段调用 <code>RAMN_SPI_SetScroll(SCREEN_HEADER_SIZE)</code> 。尽管显示屏的实际显示区域为 240x240，但其显示缓冲区大小为 240x320。这意味着，如果您希望滚动屏幕，需要绘制高度为 320 的屏幕画面（但每次仅显示其中的 240 行）。</p>
<h2 id="在闪存中保存数据" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#在闪存中保存数据">#</a>在闪存中保存数据</h2>
<p class="my-4 leading-7">您可以使用 <code>ramn_eeprom.c</code> 在模拟的 EEPROM 中保存数据（使用 STM32 的闪存）。该模块允许对 16 位索引（“地址”）读写 32 位数值。由于其中一些索引用于存储 DTC 和 VIN，因此您应使用高于 <code>DTC_LAST_VALID_ADDRESS</code> 的索引（或者通过搜索对 <code>RAMN_EEPROM_Write32</code> 的引用来禁用使用这些索引的功能）。</p>
<p class="my-4 leading-7">EEPROM 模拟层可能与 FreeRTOS 存在兼容性问题，因此在使用时务必始终检查错误，并在各种条件下进行测试。如果您在使用 <code>ramn_eeprom.c</code> 模块时频繁遇到错误，请随时与我们联系，以便我们进行调查。</p>
<p class="my-4 leading-7">如果需要的内存超过 EEPROM 模拟所能提供的容量，您可以使用 <code>stm32l5xx_hal_flash.h</code> 中的函数（文件开头的注释说明了如何使用）。请注意，在从闪存执行代码时，对其写入存在显著的限制。</p>
<h2 id="修改ioc-文件" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#修改ioc-文件">#</a>修改.ioc 文件</h2>
<p class="my-4 leading-7"><code>RAMNV1.ioc</code> 是 STM32CubeIDE 代码生成的配置文件。它定义了微控制器的引脚配置、中断、外设（CAN/CAN-FD、SPI 等）以及 FreeRTOS 设置。</p>
<p class="my-4 leading-7">您可以在 STM32CubeIDE 中编辑 <code>RAMNV1.ioc</code>,该工具提供了一个图形化界面，用于修改设置（例如，添加新的 GPIO 引脚或调整外设的波特率）。尽管也可以直接在源代码中修改这些设置（例如，通过编辑 <code>main.c</code> 中的 <code>hlpuart1.Init.baudrate = 115200;</code> ），但 STM32CubeIDE 能够自动检测无效配置，从而节省调试时间。</p>
<p class="my-4 leading-7">在项目资源管理器中双击 RAMNV1.ioc，即可打开默认的“引脚分配与配置”选项卡。如果保存时未自动提示，可选择“项目”&gt;“生成代码”，以根据您的更改重新生成代码。</p>
<h3 id="系统与外设设置" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#系统与外设设置">#</a>系统与外设设置</h3>
<p class="my-4 leading-7">大部分设置均可在 <strong class="font-semibold">“引脚分配与配置”</strong> 选项卡中进行修改。</p>
<p class="my-4 leading-7">您可以在 <strong class="font-semibold">“连接”</strong> 类别中修改外设设置。例如，选择 <strong class="font-semibold">“LPUART1”</strong> 以修改默认 UART 波特率。选择 <strong class="font-semibold">“FDCAN1”</strong> 以修改默认的 CAN/CAN-FD 设置。</p>
<p class="my-4 leading-7">STM32CubeIDE 在添加新外设时不会自动启用所需的中断。请务必检查 NVIC 部分是否已启用必要的中断。</p>
<p class="my-4 leading-7"><img src="/firmware/nvic_settings.webp" alt=""/></p>
<h3 id="freertos-设置" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#freertos-设置">#</a>FreeRTOS 设置</h3>
<p class="my-4 leading-7">FreeRTOS 设置位于 <strong class="font-semibold">“中间件与软件包”</strong> &gt; <strong class="font-semibold">“FreeRTOS”</strong> 菜单（<strong class="font-semibold">“配置参数”</strong>）中。在此，您可以特别修改“最小堆栈大小”，以防止堆栈溢出问题；如果需要更多 FreeRTOS 堆内存，则可修改 TOTAL_HEAP_SIZE。请注意，这些设置与 <a href="#%E9%93%BE%E6%8E%A5%E5%99%A8%E8%AE%BE%E7%BD%AE" class="link_a7cea  link_a9ef4 inline-link_f855c">链接器设置</a>中描述的主堆栈和堆大小不同。如果您不确定应修改哪一项，可尝试同时修改两者。</p>
<p class="my-4 leading-7">在“配置参数”菜单中，您还可以更改“内存管理方案”，默认为“heap_4”。其他方案可能不支持 <code>free()</code> 函数，因此建议您不要更改此设置。</p>
<p class="my-4 leading-7">如果您不需要 FreeRTOS 运行时统计信息，也可以禁用“GENERATE_RUN_TIME_STATS”、“USE_TRACE_FACILITY”和“USE_STATS_FORMATTING”，以优化您的项目。如果这样做，还应在 <code>ramn_config.h</code> 中禁用 <code>GENERATE_RUNTIME_STATS</code>。</p>
<p class="my-4 leading-7">打开 <strong class="font-semibold">“任务与队列”</strong> 选项卡，以修改/添加/删除 FreeRTOS 任务。双击某个任务可修改其设置（其中最重要的设置是<strong class="font-semibold">优先级</strong>和<strong class="font-semibold">堆栈大小</strong> ）。请注意，如果您重命名某个任务，STM32CubeIDE 实际上会删除该任务内的代码并生成一个新任务，因此您应先复制其内容，然后在代码生成后将其粘贴到新任务中。</p>
<h3 id="时钟设置" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#时钟设置">#</a>时钟设置</h3>
<p class="my-4 leading-7">如果您希望使用内部时钟而非外部晶振，请阅读 <code>ramn_config.h</code> 文件底部的注释。</p>
<p class="my-4 leading-7">要修改 CPU 时钟（SYSCLK），请选择顶部菜单中的 <strong class="font-semibold">“时钟配置”</strong> 选项卡，并修改 PLLCLK 的 <strong class="font-semibold">N</strong> 和 <strong class="font-semibold">R</strong> 参数。默认情况下，RAMN 仅使用 80MHz，但您可以将其提升至 110MHz。在修改此时钟后，请务必同时调整 <strong class="font-semibold">Q</strong> 值，以确保 PLLQ 仍保持 40MHz。</p>
<p class="my-4 leading-7">由于定时器依赖于 SYSCLK，如果您使用了 TIM6 和 TIM16，也需要相应地修改其设置（默认 RAMN 并不需要这些定时器；它们仅为方便您而预先配置）。</p>
<h3 id="链接器设置" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#链接器设置">#</a>链接器设置</h3>
<p class="my-4 leading-7">要增加主堆栈和主堆大小（这与 <a href="#freertos-%E8%AE%BE%E7%BD%AE" class="link_a7cea  link_a9ef4 inline-link_f855c">FreeRTOS 设置</a>中描述的 FreeRTOS 堆和堆栈大小不同），请选择顶部菜单中的 <strong class="font-semibold">“项目管理器”</strong> 选项卡，并更新“最小堆大小”和“最小堆栈大小”。</p>
<p class="my-4 leading-7">对于其他设置，您需要直接修改 <code>STM32L552CETX_FLASH.ld</code>。</p>
<h3 id="其他工具" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#其他工具">#</a>其他工具</h3>
<p class="my-4 leading-7">您可以使用 <strong class="font-semibold">“工具”</strong> 选项卡来使用其他 STM32CubeIDE 工具，例如将您的项目与另一个项目进行比较，或者在您进行更改后概览微控制器的功耗情况。</p>
<div class="rspress-directive warning"><div class="rspress-directive-title">警告</div><div class="rspress-directive-content"><p class="my-4 leading-7">STM32CubeIDE 在您使用代码生成功能时可能会删除代码。如果您对自动生成的文件（主要是 <code>main.c</code> 和 <code>main.h</code>）进行修改，请务必将其放置在 <code>USER CODE BEGIN ...</code> 和 <code>USER CODE END ...</code> 注释之间，否则这些修改将被删除。建议您在使用代码生成功能时使用版本控制系统并检查差异，以确保您的代码不会被意外删除。</p></div></div>
<h2 id="优化性能" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#优化性能">#</a>优化性能</h2>
<p class="my-4 leading-7">您可以使用 FreeRTOS 和 STM32CubeIDE 工具来优化您的应用程序。</p>
<h3 id="编译器优化" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#编译器优化">#</a>编译器优化</h3>
<p class="my-4 leading-7">您可以通过依次选择 <strong class="font-semibold">“项目”</strong> &gt; <strong class="font-semibold">“属性”</strong>,然后 <strong class="font-semibold">“C/C++ 构建”</strong> &gt; <strong class="font-semibold">“设置”</strong>,再选择 <strong class="font-semibold">“MCU GCC 编译器”</strong> &gt; <strong class="font-semibold">“优化”</strong>,来启用编译器优化。在那里，您可以选择一个优化级别以启用优化，并根据需求选择优先考虑速度或大小。</p>
<h3 id="freertos-运行时统计信息" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#freertos-运行时统计信息">#</a>FreeRTOS 运行时统计信息</h3>
<p class="my-4 leading-7">在 ECU A 上，您可以使用 slcan ‘X’命令（参见<a href="/docs/userguide/usb_tutorial.html#与-usb-交互" class="link_a7cea  link_a9ef4 inline-link_f855c">与 USB 交互</a>）来显示 FreeRTOS 运行时统计信息。您也可以在调试时通过 <strong class="font-semibold">STM32CubeIDE</strong> 查看相同的信息（选择 <strong class="font-semibold">“窗口”</strong> &gt; <strong class="font-semibold">“显示视图”</strong> &gt; <strong class="font-semibold">“FreeRTOS”</strong> &gt; <strong class="font-semibold">“任务列表”</strong>)：</p>
<p class="my-4 leading-7"><img src="/firmware/freertos_stats.webp" alt=""/></p>
<p class="my-4 leading-7">您可以查看每个任务的 <strong class="font-semibold">CPU 使用率</strong>和<strong class="font-semibold">可用堆栈的下限</strong> 。 <strong class="font-semibold">统计信息从启动时开始计算，这意味着“使用率”显示的是自启动以来的平均使用情况，而非峰值使用率。</strong> 如果您想观察高负载下的统计信息，请重启并立即启动高负载处理任务。</p>
<p class="my-4 leading-7">如果 CPU 使用率较高（例如由于复杂的软件算法），您可能需要提高 CPU 时钟速度（参见<a href="#%E6%97%B6%E9%92%9F%E8%AE%BE%E7%BD%AE" class="link_a7cea  link_a9ef4 inline-link_f855c">时钟设置</a>)，或者对代码进行重构。</p>
<p class="my-4 leading-7">“堆栈”显示任务溢出前剩余的内存量。如果该值接近零，您需要增加任务的堆栈大小（参见 <a href="#freertos-%E8%AE%BE%E7%BD%AE" class="link_a7cea  link_a9ef4 inline-link_f855c">FreeRTOS 设置</a>)。</p>
<p class="my-4 leading-7">您可以使用 <strong class="font-semibold">“窗口”</strong> &gt; <strong class="font-semibold">“显示视图”</strong> &gt; <strong class="font-semibold">“静态堆栈分析器”</strong> 来更好地了解堆栈的使用情况。 <em>（您可能需要先选择“文件” &gt; “刷新”，然后在堆栈分析器窗口中单击刷新图标，才能看到正确的数值。）</em> 请注意，某些视图以字（32 位）为单位显示大小，而另一些视图则以字节（8 位）为单位显示大小。</p>
<p class="my-4 leading-7"><img src="/firmware/stack_usage.webp" alt=""/></p>
<div class="rspress-directive warning"><div class="rspress-directive-title">警告</div><div class="rspress-directive-content"><p class="my-4 leading-7">如果您使用了代码生成功能，可能需要在 STM32CubeIDE 中为 <code>ulTotalRunTime</code>（位于 <code>tasks.c</code> 的第 396 行）添加 <code>volatile</code>,以确保统计信息能够正确读取。如果在 STM32CubeIDE 中遇到运行时统计问题，请按照<a href="http://community.st.com/t5/stm32-mcus/how-to-enable-freertos-run-time-and-stack-usage-view/ta-p/627524" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">此处</a>的步骤操作。</p></div></div>
<p class="my-4 leading-7">FreeRTOS 统计信息是通过 <strong class="font-semibold">TIM7</strong> 计算的。如果您需要更高的精度，可以修改 TIM7 的计数器周期值（例如，从 7999 改为 799），但这会增加 CPU 负载。</p>
<p class="my-4 leading-7">当您完成应用程序优化后，可以禁用运行时统计信息（请参阅 <a href="#freertos-%E8%AE%BE%E7%BD%AE" class="link_a7cea  link_a9ef4 inline-link_f855c">FreeRTOS 设置</a>)。</p>
<div class="rspress-directive info"><div class="rspress-directive-title">注意</div><div class="rspress-directive-content"><p class="my-4 leading-7"><code>RAMNV1.ioc</code> 是为 STM32L552 微控制器创建的。如果您拥有 STM32L562 微控制器并希望使用其加密硬件外设，则必须手动将“STM32L552”的引用更新为“STM32L562”。</p></div></div>
<h2 id="理解-ramn-的内存" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#理解-ramn-的内存">#</a>理解 RAMN 的内存</h2>
<p class="my-4 leading-7">请阅读 <a href="/docs/firmware/memory_layout.html#内存布局" class="link_a7cea  link_a9ef4 inline-link_f855c">内存布局</a>,尤其是当您需要内存保护时。</p>
<p class="my-4 leading-7">如果内存不足且不需要内存保护，请尝试将 <code>STM32L552CETX_FLASH.ld</code> 的内容替换为 <code>STM32L552CETX_FLASH_INSECURE.ld</code> 的内容。同时，也请尝试启用 <a href="#%E7%BC%96%E8%AF%91%E5%99%A8%E4%BC%98%E5%8C%96" class="link_a7cea  link_a9ef4 inline-link_f855c">编译器优化</a>。</p>
<p class="my-4 leading-7">如果在 <strong class="font-semibold">INSECURE_RAM 区域</strong>中出现内存不足的情况，请尝试在 <code>ramn_config.h</code> 中降低以下定义的值（某些定义在 ECU A 和 ECU B/C/D 中可能有所不同）：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><code>USB_RX_BUFFER_SIZE</code></li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>USB_TX_BUFFER_SIZE</code></li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>CAN_RX_BUFFER_SIZE</code></li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>CAN_TX_BUFFER_SIZE</code></li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>USB_COMMAND_BUFFER_SIZE</code></li>
</ul>
<p class="my-4 leading-7">如果您在 <strong class="font-semibold">RAM 区域</strong>中耗尽了内存，应尝试减小堆和栈的大小，如<a href="#%E4%BF%AE%E6%94%B9ioc-%E6%96%87%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">修改 .ioc 文件</a>一节所述。如果您不确定该减小哪个大小，可先从“最小堆大小”开始（在<a href="#%E9%93%BE%E6%8E%A5%E5%99%A8%E8%AE%BE%E7%BD%AE" class="link_a7cea  link_a9ef4 inline-link_f855c">链接器设置</a>中）。</p>
<p class="my-4 leading-7">如果您使用默认的 <code>STM32L552CETX_FLASH.ld</code> 链接器脚本，可通过在其定义中添加 <code>__attribute__ ((section (&quot;.buffers&quot;)))</code> ，将变量从 RAM 移动到 INSECURE_RAM。如果存在一个较大的变量，您认为其无需保护（例如，非关键的 FreeRTOS 任务栈），可以将其移至 INSECURE_RAM，并将释放的空间用于您自己的应用程序。</p>
<p class="my-4 leading-7">如果您想了解如何修改布局以实现内存漏洞，请参阅<a href="#%E5%AE%9E%E7%8E%B0%E6%BC%8F%E6%B4%9E" class="link_a7cea  link_a9ef4 inline-link_f855c">实现漏洞</a>一节。</p>
<h2 id="理解-ramn-的安全特性" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#理解-ramn-的安全特性">#</a>理解 RAMN 的安全特性</h2>
<h3 id="加固" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#加固">#</a>加固</h3>
<p class="my-4 leading-7">您可以在 <code>ramn_config.h</code> 中使用 <code>HARDENING</code> 标志，以禁用那些容易危及设备安全的功能。启用此标志后，您将遇到各种编译错误，提示您还应启用或禁用哪些其他标志。请根据提示建议进行处理，或者删除 <code>#error</code> 指令。</p>
<p class="my-4 leading-7">如果您不需要某些剩余功能，可通过直接编辑源代码将其移除。值得注意的是，我们建议您检查可用的 UDS 服务，并编辑 <code>RAMN_UDS_ProcessDiagPayload</code> 和 <code>RAMN_UDS_ProcessDiagPayloadFunctional</code> 。请务必重新构建索引，以确保 STM32CubeIDE 能够正确高亮显示哪些函数仍然可用（选择 <strong class="font-semibold">“项目”</strong> &gt; <strong class="font-semibold">“C/C++索引”</strong> &gt; <strong class="font-semibold">“重新构建”</strong>）。</p>
<h3 id="内存保护" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#内存保护">#</a>内存保护</h3>
<p class="my-4 leading-7">您可以在 <code>ramn_config.h</code> 中使用 <code>MEMORY_AUTOLOCK</code> 标志来保护内存。当启用此标志时，STM32 RDP 选项字节将在启动期间设置为<strong class="font-semibold">临时</strong>启用内存保护。 <strong class="font-semibold">在您移除保护之前，将无法再对固件进行调试，因此应在完成调试后再执行此操作。</strong></p>
<p class="my-4 leading-7">为确保内存保护已启用，您需要确认固件至少已被执行过一次（具体是否满足此条件取决于您用于编程固件的工具）。因此，建议您移除任何 JTAG 调试器，并对 RAMN 进行一次断电重启。</p>
<p class="my-4 leading-7">使用默认保护机制（RDP 级别 1）， <strong class="font-semibold">内存保护可随时解除，但内存会自动擦除</strong> 。您可以通过更新 <code>ramn_config.h</code> 中的 <code>RDP_OPTIONBYTE</code> 来启用 RDP 级别 2，从而对设备进行<strong class="font-semibold">永久锁定</strong> ,但相应地您将失去重新刷写和调试的能力。</p>
<p class="my-4 leading-7">要解除 ECU A 的保护，您可以使用 ‘D’ slcan 命令。默认情况下，此命令需要一个由 <code>DFU_COMMAND_STRING</code> 定义的“密码”。然而，该“密码”仅用于防止意外的内存擦除（例如由于模糊测试）；通过 JTAG 仍然可以无需任何密码直接解除保护。</p>
<p class="my-4 leading-7">ECU A 的保护会由 <code>ECUA_OptionBytes_Reset.bat</code> 和 <code>ProgramECU_A.bat</code> 自动解除。如果您更改了密码，则需要相应地更新 <code>ECUA_goToDFU.py</code> 脚本。对于 ECU B/C/D，您可以使用 <code>Unlock_BCD.bat</code> 脚本来解除内存保护。</p>
<p class="my-4 leading-7">此外，您也可以通过 STM32 引导加载程序接口来启用和禁用内存保护。STM32 引导加载程序能够独立地启用或禁用读写保护。对于 ECU A，您可以使用意法半导体提供的 DFU 工具（或 STM32CubeProgrammer）。对于 ECU B/C/D，您可以使用位于 scripts/STBootloader 文件夹中的 <code>canboot.py</code> Python 脚本：</p>
<div class="language-c"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-c" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">1</span><span class="token macro directive-hash" style="color:var(--code-token-parameter)">#</span><span class="token macro" style="color:var(--code-token-parameter)"> </span><span class="token macro expression" style="color:var(--code-token-parameter)">Enable memory read protection </span><span class="token macro expression" style="color:var(--code-token-keyword)">for</span><span class="token macro expression" style="color:var(--code-token-parameter)"> ECU B</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">2</span><span>python canboot</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>py AUTO B </span><span class="token operator">-</span><span>rp
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">3</span>
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">4</span><span></span><span class="token macro directive-hash" style="color:var(--code-token-parameter)">#</span><span class="token macro" style="color:var(--code-token-parameter)"> </span><span class="token macro expression" style="color:var(--code-token-parameter)">Enable memory write protection </span><span class="token macro expression" style="color:var(--code-token-keyword)">for</span><span class="token macro expression" style="color:var(--code-token-parameter)"> ECU B</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">5</span><span>python canboot</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>py AUTO B </span><span class="token operator">-</span><span>wp
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">6</span>
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">7</span><span></span><span class="token macro directive-hash" style="color:var(--code-token-parameter)">#</span><span class="token macro" style="color:var(--code-token-parameter)"> </span><span class="token macro expression" style="color:var(--code-token-parameter)">Remove memory read protection </span><span class="token macro expression" style="color:var(--code-token-keyword)">for</span><span class="token macro expression" style="color:var(--code-token-parameter)"> ECU B</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">8</span><span>python canboot</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>py AUTO B </span><span class="token operator">-</span><span>ru
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">9</span>
</span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">10</span><span></span><span class="token macro directive-hash" style="color:var(--code-token-parameter)">#</span><span class="token macro" style="color:var(--code-token-parameter)"> </span><span class="token macro expression" style="color:var(--code-token-parameter)">Remove memory write protection </span><span class="token macro expression" style="color:var(--code-token-keyword)">for</span><span class="token macro expression" style="color:var(--code-token-parameter)"> ECU B</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">11</span><span>python canboot</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>py AUTO B </span><span class="token operator">-</span><span>wu</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">如果您直接使用 STM32 引导加载程序接口，请务必确保内存保护设置一致，否则可能会遇到问题（请参阅<a href="/docs/firmware/common_issues.html#内存保护不一致" class="link_a7cea  link_a9ef4 inline-link_f855c">内存保护不一致</a>）。</p>
<p class="my-4 leading-7">请阅读<a href="/docs/firmware/memory_layout.html#内存布局" class="link_a7cea  link_a9ef4 inline-link_f855c">内存布局</a>,以了解如何通过 <strong class="font-semibold">MEMORY_AUTOLOCK</strong> 标志对内存进行（或无法进行）保护。请注意，SRAM1（INSECURE_RAM 区域）无法被保护，除非您永久锁定设备（请参阅 <a href="/docs/firmware/memory_layout.html#ram" class="link_a7cea  link_a9ef4 inline-link_f855c">RAM</a>)。</p>
<p class="my-4 leading-7">当 RDP 级别 1 内存保护处于激活状态时，预期的 JTAG 行为如下：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">用户可通过 JTAG 连接并移除内存保护（触发大规模内存擦除）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">用户无法读取或写入 Flash（将返回错误）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">用户无法读取或写入 SRAM2（“<strong class="font-semibold">RAM</strong>”）（仅显示零值，不会返回错误）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">用户可以读取或写入 SRAM1（“<strong class="font-semibold">INSECURE_RAM</strong>”）。 <strong class="font-semibold">但用户无法恢复执行</strong> 。</li>
<li class="[&amp;:not(:first-child)]:mt-2">用户可以执行任意代码，但该任意代码无法访问 SRAM2 或 Flash。</li>
</ul>
<h3 id="唯一硬件种子" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#唯一硬件种子">#</a>唯一硬件种子</h3>
<p class="my-4 leading-7">如果您需要为密钥派生函数提供种子，以生成每个 ECU 的唯一密钥，可以使用位于 <code>HARDWARE_UNIQUE_ID_ADDRESS</code> 处的 8 个字节。</p>
<h3 id="额外的安全功能trustzone-等" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#额外的安全功能trustzone-等">#</a>额外的安全功能（TrustZone 等）</h3>
<p class="my-4 leading-7">STM32L5 微控制器配备了 MPU，如果您需要启用内存保护功能，可以使用它。</p>
<p class="my-4 leading-7">尽管这些功能默认处于禁用状态，但您仍可为您的应用程序启用 <a href="https://www.st.com/resource/en/application_note/an5347-arm-trustzone-features-for-stm32l5-and-stm32u5-series-stmicroelectronics.pdf" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">TrustZone 功能</a>。有关 STM32L552 安全功能的更多信息，请参阅 <a href="https://www.st.com/resource/en/datasheet/stm32l552cc.pdf" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">STM32L552 数据手册</a>。</p>
<p class="my-4 leading-7">如果您的 RAMN 配备了 STM32L562 微控制器，则还可使用加密引擎（例如用于 AES 和公钥操作）。有关详细信息，请参阅 <a href="https://www.st.com/resource/en/datasheet/stm32l562ce.pdf" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">STM32L562 数据手册</a>。</p>
<h2 id="探索-ramn-的安全性" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#探索-ramn-的安全性">#</a>探索 RAMN 的安全性</h2>
<h3 id="在-ghidra-中分析-ramn-固件" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#在-ghidra-中分析-ramn-固件">#</a>在 Ghidra 中分析 RAMN 固件</h3>
<p class="my-4 leading-7">如果您希望在 Ghidra 中分析 RAMN 固件，应使用构建固件时在 <em>RAMNV1/Debug</em> 或 <em>RAMNV1/Release</em> 文件夹中生成的 .elf 文件。RAMN 所使用的 STM32L552/STM32L562 微控制器基于 ARM Cortex M-33 内核，该内核仅支持 Thumb 指令。</p>
<p class="my-4 leading-7"><strong class="font-semibold">请注意，更改编译器优化设置通常会导致生成非常不同的二进制代码。</strong></p>
<p class="my-4 leading-7">与.hex 文件不同，.elf 文件包含调试符号，这大大简化了分析过程。如果需要移除调试符号，必须使用 arm 工具链，而不是系统中可能已有的默认工具链。例如，应使用 <code>arm-none-eabi-strip</code>,而不能仅使用 <code>strip</code>。</p>
<p class="my-4 leading-7">当您在 Ghidra 中加载.hex 文件时，可能会因为缺少内存映射信息而导致分析困难。固件的默认起始地址（Flash）为 0x08000000。您应打开“ <strong class="font-semibold">工具</strong> ”&gt;“ <strong class="font-semibold">内存映射</strong> ”，并按照 <code>STM32L552CETX_FLASH.ld</code> 中定义的内容添加区域。此外，您还可以根据 <a href="https://www.st.com/resource/en/reference_manual/dm00346336-stm32l552xx-and-stm32l562xx-advanced-arm-based-32-bit-mcus-stmicroelectronics.pdf" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">STM32L5 参考手册</a>添加特殊寄存器（例如外设）的相关信息。请搜索“ <strong class="font-semibold">内存映射和寄存器边界地址</strong> ”以及“ <strong class="font-semibold">外设寄存器边界</strong> ”。您也可以找到在线资源来帮助您实现这一过程的自动化。</p>
<h3 id="为-ramn-编写-arm-shellcode" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#为-ramn-编写-arm-shellcode">#</a>为 RAMN 编写 ARM shellcode</h3>
<p class="my-4 leading-7">您可以使用常见的 Shellcode 编写工具，编写可在 RAMN 上执行的 ARM Shellcode（二进制代码）。您必须将目标选择为“ARM (thumb)”（适用于 ARM Cortex M-33 的 16 位指令）。默认情况下未启用 TrustZone，也无需进行权限提升。默认情况下已启用 RAM 执行功能，以便用户能够轻松测试 Shellcode。</p>
<p class="my-4 leading-7">您可以使用 UDS 例程 0x209（参见<a href="/docs/userguide/diag_tutorial.html#例程控制-0x31" class="link_a7cea  link_a9ef4 inline-link_f855c">例程控制 (0x31)</a>）通过 CAN 测试有效载荷。诊断任务将跳转到您的有效载荷地址。此例程要求您首先执行<a href="/docs/userguide/diag_tutorial.html#安全访问-0x27" class="link_a7cea  link_a9ef4 inline-link_f855c">安全访问 (0x27)</a> 中所述的简单安全访问方法，以防止在模糊测试过程中发生意外执行。由于 UDS 数据直接复制到内存中，因此您必须以小端格式提供指令（例如，在您的 CAN 有效载荷中，<code>nop</code> 应显示为 <code>00BF</code>,而不是 <code>BF00</code>）。</p>
<p class="my-4 leading-7">该函数不会自动返回，因此您应保存上下文并自行安全地返回，例如在末尾执行 <code>bx lr</code>（<code>7047</code>）。只有当您的代码成功返回时，UDS 服务才会作出响应（响应是在有效载荷执行之后，而非之前）。</p>
<p class="my-4 leading-7">例如，有效载荷 <code>00BF7047</code> 将执行一条 NOP 指令并返回。</p>
<p class="my-4 leading-7">为 RAMN 编写 ARM shellcode 并不特别困难，但请注意，网络上的大多数资源都是针对 Linux 嵌入式系统，而非 FreeRTOS 嵌入式系统。虽然大部分技术仍然适用，但在 RAMN 上无法通过系统调用“弹出一个 shell”，因为根本不存在 shell。同样地，需要注意的是，大多数任务会处于休眠状态，等待通知后才继续执行。如果你利用某个任务并调用一个函数，而该函数却在等待本应属于另一个任务的通知，那么它将永远挂起，除非你先覆盖该通知处理程序，或者找到其他方式来触发通知。类似地，某个任务可能不会检查资源是否可用，因为它假定自己是唯一使用该资源的任务，因此你可能会无意中影响到其他任务。</p>
<h3 id="使用-openocd-进行调试" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#使用-openocd-进行调试">#</a>使用 OpenOCD 进行调试</h3>
<p class="my-4 leading-7">你可以将 OpenOCD 调试器连接到 RAMN 的 ECU。有关连接方式，请参阅 <a href="/docs/hardware/flashing.html#jtag-硬件接口" class="link_a7cea  link_a9ef4 inline-link_f855c">JTAG 硬件接口</a>。</p>
<p class="my-4 leading-7">你应该使用 <code>stm32l5x.cfg</code> 配置文件（在 Linux 系统中，该文件通常位于 /usr/share/openocd 下的某个位置）。</p>
<p class="my-4 leading-7">启动一个 openocd 服务器，并通过以下方式连接到它：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>openocd -f &lt;your_debugger.cfg&gt; -f stm32l5x.cfg
nc localhost 4444  # replace 4444 with actual openocd server port
</code></div></div>
<p class="my-4 leading-7">然后，您可以执行调试命令，例如：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>set_reg {pc 0x08000000}
read_memory 0x200000000 32 100
resume
</code></div></div>
<h2 id="典型项目指导" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#典型项目指导">#</a>典型项目指导</h2>
<h3 id="为ctf或类似活动准备-ramn" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#为ctf或类似活动准备-ramn">#</a>为CTF（或类似活动）准备 RAMN</h3>
<p class="my-4 leading-7">您可以按照本页面的说明来创建 CTF 挑战。例如，您可以根据 <a href="#can-%E6%B5%81%E9%87%8F%E7%9A%84%E7%AE%80%E5%8D%95%E4%BF%AE%E6%94%B9%E6%A0%87%E8%AF%86%E7%AC%A6%E5%91%A8%E6%9C%9F%E7%AD%89" class="link_a7cea  link_a9ef4 inline-link_f855c">CAN 流量的简单修改（标识符、周期等）</a> 一节中的说明，修改 CAN 标识符，并让参与者猜测您新定义的标识符。您可以在 <a href="/docs/ctf_writeups.html#ctf-题解" class="link_a7cea  link_a9ef4 inline-link_f855c">CTF 解题报告</a>一节中找到简单和高级 CTF 挑战的示例。</p>
<p class="my-4 leading-7">如果您想将 RAMN 用于CTF或类似活动，需要确保用户无法轻易读取固件或执行任意代码。 <strong class="font-semibold">如果您的 CTF 面向初学者，可以跳过本节中的说明</strong> 。</p>
<p class="my-4 leading-7">为确保用户无法轻易转储固件，您应修改 <code>ramn_config.h</code>,以实现以下目标：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">启用 <code>HARDENING</code>,以移除潜在的危险功能（如用于读写内存的 UDS 服务等）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">启用 <code>MEMORY_AUTOLOCK</code>,以便在启动时自动启用 STM32 内存保护（RDP），从而防止通过 JTAG 或引导加载程序模式进行内存转储。</li>
</ul>
<p class="my-4 leading-7">此外，建议开启编译器优化，以移除可能残留在内存中的未使用代码。当定义了 <code>MEMORY_AUTOLOCK</code> 标志时，您将无法调试固件，因此应在开发完成后才启用该选项。</p>
<p class="my-4 leading-7">请阅读<a href="/docs/firmware/customizing_guide.html#理解-ramn-的安全特性" class="link_a7cea  link_a9ef4 inline-link_f855c">理解 RAMN 的安全特性</a>部分，以了解更多关于内存保护的信息。请记住，<code>MEMORY_AUTOLOCK</code> 仅会保护 Flash 和 SRAM2（“RAM”）区域的内存。SRAM1（“INSECURE_RAM”）仍可通过调试接口进行读取。因此，您应确保没有敏感数据（标志等）存储在 SRAM1 中。默认情况下，源代码不会将任何内容放入 SRAM1，除非您主动在那里声明变量（参见 <a href="/docs/firmware/memory_layout.html#ram" class="link_a7cea  link_a9ef4 inline-link_f855c">RAM</a>）。RAMN 仅将 SRAM1 用于通信缓冲区（USB、SPI、CAN 等），因为这些缓冲区无论如何都会始终暴露在外。</p>
<p class="my-4 leading-7">默认情况下，RAM 是可执行的。如果您禁止 RAM 代码执行，将无法通过 USB 移除内存保护（使用 slcan ‘D’命令），并且只能通过 JTAG 移除 ECU A 的保护。</p>
<p class="my-4 leading-7">由于 ECU A 的功能最为复杂，因此最有可能存在未预料到的漏洞，这些漏洞最终可能比你实际设置的挑战更容易被利用。如果你希望为高级用户设计一场 CTF 比赛，建议将最具难度的挑战部署在 ECU B/C/D 上。</p>
<p class="my-4 leading-7">在启用 <code>HARDENING</code> 时，许多 USB 和 UDS 服务仍处于活动状态，这可能会让参与者误以为这些服务是需要分析的目标。您应明确告知参与者哪些服务不在本次范围之内（以避免他们浪费时间）。</p>
<p class="my-4 leading-7">完成 CTF 后，如果您启用了 <code>MEMORY_AUTOLOCK</code>,可以通过执行 scripts/STBootloader/windows 文件夹中的 <code>Unlock_BCD.bat</code> 和 <code>ECUA_OptionBytes_Reset.bat</code> 来移除内存保护。 <strong class="font-semibold">ECU A 需要使用有效的固件进行编程才能执行</strong> <code>Unlock_BCD.bat</code><strong class="font-semibold">,因此应最后擦除 ECU A。</strong> 然后，您可以执行 <code>ProgramECU_A.bat</code> 和 <code>ProgramECU_BCD.bat</code>（来自原始 Github 仓库）以恢复原始固件。</p>
<h3 id="实现安全的-can-总线secoc-等" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#实现安全的-can-总线secoc-等">#</a>实现安全的 CAN 总线（SecOC 等）</h3>
<p class="my-4 leading-7">要在 CAN（或 CAN-FD）上实现您自己的消息认证或加密机制，请编辑以下 <code>ramn_dbc.c</code> 函数：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><code>RAMN_DBC_FormatDefaultPeriodicMessage</code> 以实现您的机制（例如，加密有效载荷、计算 MAC 而非 CRC32 等）。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>RAMN_DBC_ProcessCANMessage</code> 以实现相关消息处理（例如，解密有效载荷、验证 MAC 等）。</li>
</ul>
<p class="my-4 leading-7">如果您希望使用 CAN-FD 而非 CAN，请阅读<a href="#%E5%8D%87%E7%BA%A7%E5%88%B0-can-fd" class="link_a7cea  link_a9ef4 inline-link_f855c">升级到 CAN-FD</a> 部分。要深入了解 <code>ramn_dbc.c</code> 模块，请阅读 <a href="#can-%E6%B5%81%E9%87%8F%E7%9A%84%E9%AB%98%E7%BA%A7%E4%BF%AE%E6%94%B9%E6%9C%89%E6%95%88%E8%BD%BD%E8%8D%B7%E6%A0%BC%E5%BC%8F%E7%AD%89" class="link_a7cea  link_a9ef4 inline-link_f855c">CAN 流量的高级修改（有效载荷格式等）</a> 部分。</p>
<p class="my-4 leading-7">要仅修改特定的 CAN/CAN-FD 报文（例如制动控制报文），而不是所有报文，请将 <code>RAMN_DBC_Send</code> 更新为调用您的函数，而非 <code>RAMN_DBC_FormatDefaultPeriodicMessage</code> 。例如：</p>
<div class="language-c"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-c" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">1</span><span class="token" style="color:var(--code-token-keyword)">if</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>periodicTxCANMsgs</span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>i</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token operator">-&gt;</span><span>header</span><span class="token operator">-&gt;</span><span>Identifier </span><span class="token operator">==</span><span> CAN_SIM_CONTROL_BRAKE_CANID</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">2</span><span></span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">3</span><span></span><span class="token" style="color:var(--code-token-comment)">// Your custom code, for the brake control message</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">4</span><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">5</span><span></span><span class="token" style="color:var(--code-token-keyword)">else</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">6</span><span></span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">7</span><span></span><span class="token" style="color:var(--code-token-comment)">// Original code, applied to other messages</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">8</span><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">对于加密操作，您可以使用众多<strong class="font-semibold">嵌入式</strong>软件加密库之一（例如：<a href="https://github.com/kokke/tiny-AES-c" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">Tiny AES</a> 或 <a href="https://wiki.st.com/stm32mcu/wiki/Security:Introduction_to_the_cryptographic_library_with_STM32" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">CMOX</a>）。如果您的 RAMN 配备了 STM32L562 微控制器，您还可以访问用于私钥和公钥操作的硬件加密引擎。</p>
<p class="my-4 leading-7">在为<strong class="font-semibold">所有</strong> ECU 构建并刷写固件后，RAMN 应该能够照常运行，但会采用您更新后的流量规范。</p>
<p class="my-4 leading-7">参考：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%94%AF%E4%B8%80%E7%A1%AC%E4%BB%B6%E7%A7%8D%E5%AD%90" class="link_a7cea  link_a9ef4 inline-link_f855c">唯一硬件种子</a>：如果您需要用于密钥派生的唯一硬件种子。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><a href="#%E5%9C%A8%E9%97%AA%E5%AD%98%E4%B8%AD%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE" class="link_a7cea  link_a9ef4 inline-link_f855c">在闪存中保存数据</a>：如果您需要存储永久性数据（例如计数器）。</li>
</ul>
<h3 id="实现自定义引导程序ota安全启动等" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#实现自定义引导程序ota安全启动等">#</a>实现自定义引导程序（OTA、安全启动等）</h3>
<p class="my-4 leading-7">首先，请阅读<a href="/docs/firmware/memory_layout.html#内存布局" class="link_a7cea  link_a9ef4 inline-link_f855c">内存布局</a>部分，以了解默认的内存布局。</p>
<p class="my-4 leading-7">您应假设在从内部闪存执行代码时，无法向其写入数据。您可以选择以下任一方式：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">在双 bank 模式下使用 STM32，这样可以在一个 bank 中执行代码的同时向另一个 bank 写入代码。</li>
<li class="[&amp;:not(:first-child)]:mt-2">在单 bank 模式下使用 STM32，但将您的代码从 RAM 中执行。</li>
</ul>
<p class="my-4 leading-7">如果您想使用双存储区模式实现内部存储器的重新刷写，请<strong class="font-semibold">务必确保您使用的微控制器具有 512KB 内存</strong> （STM32 微控制器参考型号以 CET6 结尾）。否则，您的微控制器仅配备一个 256kB 的闪存存储区。</p>
<p class="my-4 leading-7">您可以通过使用 <code>__attribute__((__section__(&quot;.RamFunc&quot;)))</code> 将函数放入 RAM 中。有关此类示例，请参阅 <code>ramn_memory.c</code>。如果您希望对闪存执行写操作，很可能还需要使用 <code>__disable_irq();</code> 来禁用中断，因为默认情况下，中断服务例程位于闪存中。</p>
<p class="my-4 leading-7">UDS 重新编程依赖于双 bank 模式，它可能会切换 bank 并覆盖内存的任何区域。因此，您可能需要禁用 UDS 重新编程（在 <code>ramn_config.h</code> 中取消定义 <code>ENABLE_UDS_REPROGRAMMING</code>），或者更新 <code>ramn_uds.c</code> 中的 UDS 重新编程接口，以使其与您的引导程序兼容。</p>
<p class="my-4 leading-7">RAMN 没有自定义引导程序，而是直接运行您刷入的固件。然而，STM32L5 微控制器已经内置了一个<strong class="font-semibold">硬件</strong>引导程序。该引导程序通常仅在启动时 BOOT0 引脚为高电平时才会执行。</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">ECU A <strong class="font-semibold">忽略</strong>物理 BOOT0 引脚的状态，并根据其 STM32 选项字节（<strong class="font-semibold">nSWBOOT0</strong> 和 <strong class="font-semibold">nBOOT0</strong>）来决定是否进入引导加载程序模式。</li>
<li class="[&amp;:not(:first-child)]:mt-2">ECU B/C/D 则根据其物理 BOOT0 引脚的状态（由 ECU A 驱动）来决定是否进入引导加载程序模式。</li>
</ul>
<p class="my-4 leading-7">该 STM32 引导加载程序位于只读存储器中，无法进行修改。虽然您可以通过修改 STM32 引导加载程序的地址（<strong class="font-semibold">NSBOOTADD1</strong> 选项字节，默认值为 0x0BF90000）来完全替换它，但并不推荐这样做，因为这将导致您无法再使用 <em>scripts/STBootloader</em> 文件夹中的脚本。同样地，您也可以通过修改 STM32 的 <strong class="font-semibold">NSBOOTADD0</strong> 选项字节（默认值为 0x08000000）来更改应用程序启动地址（当 BOOT0 为低电平时启动）。</p>
<p class="my-4 leading-7">如果你的目标是为研究或教育目的实现一个概念验证（例如 OTA、安全启动等），我们建议你：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">忽略 STM32 的引导加载程序和选项字节，并假设 <strong class="font-semibold">0x08000000</strong> 是代码执行“安全”开始的位置。</li>
<li class="[&amp;:not(:first-child)]:mt-2">将您的自定义引导加载程序编写至 <strong class="font-semibold">0x08000000</strong> 处（您可以使用 RAMN 的原始源代码，或任何 STM32CubeIDE 模板项目）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">将应用程序编写至 <strong class="font-semibold">0x08000000 + 引导加载程序最大长度</strong>处（使用 RAMN 默认源代码的副本，并按照以下说明进行修改）。</li>
</ul>
<p class="my-4 leading-7">您可以通过修改 <code>STM32L552CETX_FLASH.ld</code> 中 <code>FLASH (rx) : ORIGIN = 0x8000000, LENGTH = 248K</code> 行来调整应用程序所使用的内存布局。如果您修改了项目的起始地址，还需确保中断向量表指向新的起始地址。这需要通过修改 <code>main.c</code> 中 <code>main()</code> 的最开始几行来实现：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>__disable_irq();
SCB-&gt;VTOR =  /* interrupt table location, whatever you set ORIGIN to in STM32L552CETX_FLASH.ld*/ ;
__DSB();
__enable_irq();
</code></div></div>
<p class="my-4 leading-7">这些代码行用于确保即使前一阶段（之前的引导加载程序）修改了中断向量表，代码仍能正确启动。 <strong class="font-semibold">如果您为引导程序创建一个新的 STM32CubeIDE 项目，还需要添加以下几行代码，以将中断表向量指向您的引导程序起始地址（即使该地址默认为 0x08000000）</strong>。这是因为 STM32CubeIDE 模板项目不会重置中断表向量，但该向量可能已被 STM32 嵌入式引导程序修改。</p>
<p class="my-4 leading-7">一旦您完成引导程序的开发，如果确实需要，您可以禁用 STM32 嵌入式引导程序，例如通过将 <strong class="font-semibold">NSBOOTADD0</strong> 和 <strong class="font-semibold">NSBOOTADD1</strong> 设置为您引导程序的地址，并启用（永久性）内存保护（参见<a href="#%E5%86%85%E5%AD%98%E4%BF%9D%E6%8A%A4" class="link_a7cea  link_a9ef4 inline-link_f855c">内存保护</a>）。有关更多详细信息，请参阅<a href="https://www.st.com/content/ccc/resource/training/technical/product_training/group1/5a/01/e5/24/db/15/41/81/STM32L5-System-Boot_Configuration_BOOT/files/STM32L5-System-Boot_Configuration_BOOT.pdf/_jcr_content/translations/en.STM32L5-System-Boot_Configuration_BOOT.pdf" rel="noopener noreferrer" target="_blank" class="link_a7cea  link_a9ef4 inline-link_f855c">启动配置</a>。</p>
<h3 id="实现漏洞" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#实现漏洞">#</a>实现漏洞</h3>
<p class="my-4 leading-7">如果你想在 RAMN 上实现内存漏洞（例如用于安全培训），很可能需要让某些变量在内存中彼此相邻。确保变量相邻的简单方法是使用 C 语言中的结构体 ,但如果这些变量属于不同的模块，这种方法并不实用。</p>
<p class="my-4 leading-7">请注意，使用 GCC 时，您无法采用某些可能在网上找到的建议（例如，使用 <code>at</code> 属性）。您可以通过使用 <code>section</code> 属性，确保某些变量（即使它们属于不同的模块）在特定内存区域中彼此相邻。例如，如果您希望确保 <code>variable1</code> 和 <code>variable2</code> 相邻放置，可以按如下方式定义它们：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>__attribute__((section(&quot;.variable1&quot;))) char variable1[SIZE1];

/* Possibly in another file */

__attribute__((section(&quot;.variable2&quot;))) char variable2[SIZE2];
</code></div></div>
<p class="my-4 leading-7">然后，您可以修改链接器脚本 <code>STM32L552CETX_FLASH.ld</code>,并使用 <code>KEEP</code> 指令，以使这些变量位于特定区域。例如，如果您希望 <code>variable2</code> 位于 <code>variable1</code> 之前，在 <code>.bss</code> 区域的末尾，只需在 <code>*(.bss*)</code> 之后添加以下几行：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>KEEP(*(.variable2))
KEEP(*(.variable1))
</code></div></div>
<p class="my-4 leading-7">或者，您也可以通过在 <code>STM32L552CETX_FLASH.ld</code> 中定义自定义区域，为这些变量创建新的区域：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>._custom :
{
  KEEP(*(.variable2))
  KEEP(*(.variable1))
} &gt;RAM
</code></div></div>
<p class="my-4 leading-7">例如，如果您希望确保它们被放置在 RAM 的最末端，请在 HEAP 段的定义（以 <code>._user_heap_stack :</code> 开头）之后立即添加上述定义。</p>
<h3 id="创建新扩展" class="mt-10 mb-2 leading-7 text-xl title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#创建新扩展">#</a>创建新扩展</h3>
<p class="my-4 leading-7">有关扩展硬件的详细信息，请参阅<a href="/docs/hardware/expansions.html#扩展端口" class="link_a7cea  link_a9ef4 inline-link_f855c">扩展端口</a>页面。</p>
<p class="my-4 leading-7">设计扩展时最易使用的接口是 <strong class="font-semibold">UART</strong>,但您也可以使用 I2C（主设备或从设备）、SPI（主设备或从设备）、基于定时器的接口（例如用于 WS2812B LED 和伺服电机的 PWM 控制）、模数转换器（ADC）以及 GPIO（例如用于位操作或中断）。</p>
<p class="my-4 leading-7"><strong class="font-semibold">UART（LPUART1，速率为 115200bps）和 I2C（I2C2，设备模式，地址为 0x77）仅为方便您使用而预先配置；它们并未被主动使用。</strong> SPI（SPI2）已配置，并由 ECU A 和 D 主动用于控制显示屏和 LED。 <strong class="font-semibold">如果您希望在 ECU A 和 D 上使用 SPI 进行自定义扩展，则需要对通信进行复用，并且将无法以设备模式使用 SPI</strong>（除非您移除原有的扩展模块）。</p>
<p class="my-4 leading-7">ECU A 上配备了一个 SD 卡读卡器，可通过 SPI 模式访问 SD 卡。RAMN 并未主动使用该功能，但其本身是可用的。 <strong class="font-semibold">PB10 引脚同时用于预配置的 I2C SCL 引脚和 ECU A 上 SD 卡读卡器的 CS 引脚，因此除非您清楚自己的操作，否则应假设无法同时使用 SD 卡读卡器和 I2C</strong>。</p>
<p class="my-4 leading-7">如果您计划使 RAMN 的总功耗超过 500 mA，则应更新 USB 描述符中的“MaxPower”字段（位于 <code>usbd_composite.c</code> 中）。</p>
<div class="rspress-directive warning"><div class="rspress-directive-title">警告</div><div class="rspress-directive-content"><p class="my-4 leading-7">在制作扩展板之前，我们强烈建议您打开 ioc 文件（参见<a href="#%E4%BF%AE%E6%94%B9ioc-%E6%96%87%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">修改 .ioc 文件</a>），并充分配置微控制器，以确保您所需的所有功能均在所用引脚上可用，并自动检查潜在的冲突。</p></div></div>
<h4 id="uart" class="mt-8 leading-6 text-lg title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#uart">#</a>UART</h4>
<p class="my-4 leading-7">您需要连接 TX 和 RX 引脚，以实现与扩展设备上的通信（如果仅单向通信，则只需连接其中一个引脚）。</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">将 <strong class="font-semibold">LPUART1_RX (PA3)连接到设备的 TX 引脚</strong> （RAMN 将其用作 UART 输入）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">将 <strong class="font-semibold">LPUART1_TX (PA2)连接到设备的 RX 引脚</strong> （RAMN 将其用作 UART 输出）。</li>
</ul>
<p class="my-4 leading-7">换句话说，您可能需要在 RAMN 与您的扩展设备之间<strong class="font-semibold">交叉 RX 和 TX 引脚</strong> 。此外，您还可以选择使用 PA6 作为“CTS”，PB1 作为“RTS”。</p>
<p class="my-4 leading-7">要在 RAMN 固件中启用 UART，您需要在 <code>ramn_config.h</code> 中定义 <code>ENABLE_UART</code> 标志。之后，您可以在 <code>ramn_customize.c</code> 中使用钩子来发送和接收 UART 数据（主要可以使用 <code>RAMN_CUSTOM_ReceiveUART</code> 以及 <code>RAMN_UART_SendFromTask</code> 或 <code>RAMN_UART_SendStringFromTask</code>)。</p>
<p class="my-4 leading-7">如果需要更改波特率或其他 UART 设置，请参阅<a href="#%E4%BF%AE%E6%94%B9ioc-%E6%96%87%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">修改 .ioc 文件</a>部分。ECU A 还需要执行一些额外的步骤（详见 <code>ramn_config.h</code>)。</p>
<h4 id="i2c" class="mt-8 leading-6 text-lg title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#i2c">#</a>I2C</h4>
<p class="my-4 leading-7">你需要连接：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">PB10（I2C2_SCL）</strong> 连接到扩展设备上 <strong class="font-semibold">SCL</strong> 引脚。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">PB11（I2C2_SDA）</strong> 连接到扩展设备上 <strong class="font-semibold">SDA</strong> 引脚。</li>
</ul>
<p class="my-4 leading-7">默认情况下，RAMN 配置为 <strong class="font-semibold">I2C 设备模式</strong> 。无需对 I2C 进行“交叉接线”，因此可直接将 SCL 连接到 SCL，SDA 连接到 SDA。如果希望将 RAMN ECU 用作 I2C 主设备，只需更改 I2C2 外设配置（参见<a href="#%E4%BF%AE%E6%94%B9ioc-%E6%96%87%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">修改 .ioc 文件</a>），连接保持不变。</p>
<p class="my-4 leading-7"><strong class="font-semibold">默认情况下会启用内部上拉电阻，如果您的扩展设备上已存在上拉电阻，您可能需要将其禁用。</strong></p>
<p class="my-4 leading-7">要在 RAMN 的固件中启用 I2C，请在 <code>ramn_config.h</code> 中启用 <code>ENABLE_I2C</code> 标志。之后，您可以在 <code>ramn_customize.c</code> 中使用钩子（在接收数据时为 <code>RAMN_CUSTOM_ReceiveI2C</code>,在接收到传输请求时为 <code>RAMN_CUSTOM_PrepareTransmitDataI2C</code> ）。</p>
<p class="my-4 leading-7">如果您希望将 RAMN 用作主设备，可以直接使用 HAL 库（例如使用 <code>HAL_I2C_Master_Transmit</code> 和 <code>HAL_I2C_Master_Receive</code> 等函数，并参考网上众多的 STM32 教程）。有关使用示例，请参阅 SPI 部分（I2C 与 SPI 类似）。</p>
<div class="rspress-directive info"><div class="rspress-directive-title">注意</div><div class="rspress-directive-content"><p class="my-4 leading-7">如果要将 DMA 功能与 I2C 一起使用，还需要在 RAMNV1.ioc 文件中更新 DMA 配置（以配置 I2C DMA），并重新生成代码（请参阅 <a href="#%E4%BF%AE%E6%94%B9ioc-%E6%96%87%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">修改 .ioc 文件</a>）。</p></div></div>
<h4 id="spi" class="mt-8 leading-6 text-lg title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#spi">#</a>SPI</h4>
<p class="my-4 leading-7">您需要连接 SCK、MISO、MOSI 和 CS 引脚。如果不存在从设备到主设备的通信，则无需使用 MISO 引脚。</p>
<p class="my-4 leading-7">默认情况下，RAMN 配置为 <strong class="font-semibold">SPI 主模式</strong> ,您应连接以下引脚：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">PB13 (SPI2_SCK)</strong> 至您扩展设备上的 SCK 引脚。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">PB14 (SPI2_MISO)</strong> 至您扩展设备上的 MISO 引脚。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">PB15 (SPI2_MOSI)</strong> 至您扩展设备上的 MOSI 引脚。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">PA8 (Other_nCS)</strong> 至您扩展设备上的 CS 引脚。</li>
</ul>
<p class="my-4 leading-7"><strong class="font-semibold">PB2 (LCD_nCS)</strong> 用作 ECU A 和 ECU D 扩展的“片选”（CS）引脚。请勿将其用于您自己的扩展。</p>
<p class="my-4 leading-7">无需将线路交叉连接 SPI（将 MISO 连接到 MISO，将 MOSI 连接到 MOSI）。默认情况下，<strong class="font-semibold">PB14（MISO）具有一个启用的内部上拉电阻</strong> （以兼容 ECU A 扩展上的 SD 卡读卡器）。如果您的扩展已自带或不需要上拉电阻，则应将其禁用。</p>
<p class="my-4 leading-7">如果要使用 SPI 访问 ECU A 显示屏上的 SD 卡读卡器，必须修改 RAMNV1.ioc 文件以禁用 I2C，并将 <strong class="font-semibold">PB10</strong> 配置为输出（请参阅<a href="#%E4%BF%AE%E6%94%B9ioc-%E6%96%87%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">修改.ioc 文件</a>），然后将其用作 SD 卡的片选引脚。</p>
<p class="my-4 leading-7">要在固件中启用 SPI，请在 <code>ramn_config.h</code> 中启用 <code>ENABLE_SPI</code> 标志。SPI 的 DMA 已经配置完毕。您可以参考网上众多 STM32 教程，使用 HAL SPI 接口（例如 <code>HAL_SPI_Transmit_DMA</code> 等）。</p>
<div class="rspress-directive warning"><div class="rspress-directive-title">警告</div><div class="rspress-directive-content"><p class="my-4 leading-7">RAMN 的 SPI 功能通常通过启动传输并进入休眠状态，直到接收到传输完成的通知。 <code>ramn_spi.c</code> 假定在调用函数时 SPI 外设已准备就绪，并且仅在传输完成后通知主周期性任务，因此您应仅从主周期性任务中调用 SPI 函数，例如在 <code>RAMN_CUSTOM_Update</code> 中。或者，您也可以修改 SPI 模块以改变这一行为。</p></div></div>
<p class="my-4 leading-7">如果您在主周期性任务中编写代码（例如在 <code>ramn_customize.c</code> 中的 <code>RAMN_CUSTOM_Update</code> 中），则当您的代码被调用时，SPI 外设将始终处于就绪状态，并且您应当仅在外设再次就绪时才返回。</p>
<p class="my-4 leading-7">例如，你可以通过以下伪代码发送和接收 SPI 消息：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>HAL_GPIO_WritePin(Other_nCS_GPIO_Port, Other_nCS_Pin, GPIO_PIN_RESET); // Set CS pin low
HAL_SPI_Transmit(hspi, tx_buffer, tx_size, timeout_in_ms); // Transmit Message
HAL_SPI_Receive(hspi, rx_buffer, rx_size, timeout_in_ms); // Receive Answer
HAL_GPIO_WritePin(Other_nCS_GPIO_Port, Other_nCS_Pin, GPIO_PIN_SET); // Set CS pin high
</code></div></div>
<p class="my-4 leading-7">上述代码在等待时会占用 100%的 CPU，从而阻止低优先级任务的执行。因此，建议你使用等效的 DMA 函数（并在等待期间允许其他任务执行）。要调用 DMA 函数并等待通知，你可以使用如下示例：</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>HAL_GPIO_WritePin(Other_nCS_GPIO_Port, Other_nCS_Pin, GPIO_PIN_RESET); // Set CS pin low
result = HAL_SPI_TransmitReceive_DMA(hspi, tx_buffer, rx_size, size); // Start transfer
if (result == HAL_OK) ulTaskNotifyTake( pdTRUE, portMAX_DELAY); // Wait for a notification
HAL_GPIO_WritePin(Other_nCS_GPIO_Port, Other_nCS_Pin, GPIO_PIN_SET); // Set CS pin high
</code></div></div>
<p class="my-4 leading-7">然后，你需要确保在传输完成后，通过覆盖与你所调用函数相关联的回调函数，来通知并恢复任务的执行。</p>
<div class="language-c"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-c" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">1</span><span class="token" style="color:var(--code-token-keyword)">void</span><span> </span><span class="token" style="color:var(--code-token-function)">HAL_SPI_TxRxCpltCallback</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>SPI_HandleTypeDef </span><span class="token operator">*</span><span>hspi</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">2</span><span></span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">3</span><span>BaseType_t xHigherPriorityTaskWoken </span><span class="token operator">=</span><span> pdFALSE</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">4</span><span></span><span class="token" style="color:var(--code-token-function)">vTaskNotifyGiveFromISR</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token operator">&lt;</span><span>your_task</span><span class="token operator">&gt;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span class="token operator">&amp;</span><span>xHigherPriorityTaskWoken</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span> </span><span class="token" style="color:var(--code-token-comment)">// Notify task</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">5</span><span></span><span class="token" style="color:var(--code-token-function)">portYIELD_FROM_ISR</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span> xHigherPriorityTaskWoken </span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span> </span><span class="token" style="color:var(--code-token-comment)">// Make your task run as soon as possible.</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:var(--code-token-comment)">6</span><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span></span></code></pre></div><div class="code-button-group_fb445"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_fb89b"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_ccd3d"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="code-copy-button_c5089" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_ef942"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_d5ec0"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">如果遇到问题，请确保已启用 SPI 中断（参见<a href="#%E4%BF%AE%E6%94%B9ioc-%E6%96%87%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">修改.ioc 文件</a>）。</p>
<h4 id="模数转换器adc" class="mt-8 leading-6 text-lg title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#模数转换器adc">#</a>模数转换器（ADC）</h4>
<p class="my-4 leading-7"><strong class="font-semibold">PA6、PA7、PB0 和 PB1 可用作 ADC</strong>,且不会与其他接口发生冲突。如果需要更多 ADC，还可以禁用 UART 接口，这样 PA2 和 PA3 将被释放出来，同样可配置为 ADC。</p>
<p class="my-4 leading-7">默认情况下，RAMN 使用 DMA 定期从 ADC 读取数据，并自动将最新的 12 位值存储到一个由 16 位变量组成的数组中。</p>
<p class="my-4 leading-7">如果这种行为正是您所需要的，只需将新的 ADC 引脚配置为 <strong class="font-semibold">“ADC1_INx”</strong>,并在 .ioc 文件中更新 ADC1 设置以包含您的新 ADC（参见 <a href="#%E4%BF%AE%E6%94%B9ioc-%E6%96%87%E4%BB%B6" class="link_a7cea  link_a9ef4 inline-link_f855c">修改 .ioc 文件</a>）。请务必更新所有相关字段，包括“转换次数”字段。然后，在 <code>ramn_sensor.h</code> 中更新 <code>NUMBER_OF_ADC</code>,以包含您的新 ADC。对于 ECU A，还应在 <code>ramn_config.h</code> 中定义 <code>ENABLE_ADC</code> 标志位。</p>
<p class="my-4 leading-7">如果你需要另一种行为，应将你的 ADC 引脚配置为 <strong class="font-semibold">“ADC2_Inx”</strong>（使用 2 而非 1），然后按照网上众多 STM32 教程中的说明，对 ADC2 进行配置以满足你的需求。</p>
<h4 id="定时器pwm" class="mt-8 leading-6 text-lg title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#定时器pwm">#</a>定时器（PWM）</h4>
<p class="my-4 leading-7"><strong class="font-semibold">PA6、PA7、PB0 和 PB1</strong> 未被分配功能，可配置为定时器（输入或输出）。它们通常可用于读取和写入 PWM 信号， <strong class="font-semibold">但不同定时器的功能有所差异，因此你应确认这些引脚具备你所需的精确功能</strong> 。</p>
<p class="my-4 leading-7">RAMN 默认情况下不需要 UART 和 I2C。如果你不使用 UART，也可以将 PA2 和 PA3 用作定时器引脚。如果你不使用 I2C，也可以将 PB10 和 PB11 用作定时器引脚。对于不使用 SPI 的 ECU B 和 C，你还可以考虑将所有 SPI 引脚用作定时器引脚。</p>
<h4 id="gpio-与中断" class="mt-8 leading-6 text-lg title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#gpio-与中断">#</a>GPIO 与中断</h4>
<p class="my-4 leading-7"><strong class="font-semibold">PA6、PA7、PB0 和 PB1</strong> 未分配功能，均可配置为 GPIO 或外部中断。</p>
<p class="my-4 leading-7">通常，大多数 STM32 引脚可用作 GPIO 或外部中断。如果需要大量引脚，请考虑禁用未使用的接口并复用其引脚，具体说明请参见<a href="#%E5%AE%9A%E6%97%B6%E5%99%A8pwm" class="link_a7cea  link_a9ef4 inline-link_f855c">定时器（PWM）</a>。</p>
<h2 id="freertos-通用提示" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#freertos-通用提示">#</a>FreeRTOS 通用提示</h2>
<p class="my-4 leading-7">有关 FreeRTOS 如何用于实现 RAMN 功能的概述，请参阅 <a href="/docs/firmware/architecture.html#固件架构" class="link_a7cea  link_a9ef4 inline-link_f855c">固件架构</a>。以下是一些针对不熟悉 RTOS 用户的 FreeRTOS 使用技巧：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">与 Linux 等多任务操作系统不同，FreeRTOS 严格实施任务优先级。如果存在更高优先级的任务准备运行，低优先级任务将<strong class="font-semibold">完全</strong>不会执行。如果您添加了一个高优先级任务，请确保它不会导致低优先级任务长时间得不到 CPU 时间（它不应主动等待某些事件）。同样，如果您添加了一个低优先级任务，请验证在 RAMN 高负载情况下该任务不会出现资源不足的情况。您可以使用 scripts/diagnostics 文件夹中的 <code>UDS_LoadTest.py</code> 脚本来测试此类问题。您还可以使用 <code>vTaskPrioritySet()</code> 动态调整优先级。</li>
<li class="[&amp;:not(:first-child)]:mt-2">使用 <code>taskYIELD()</code>（或 <code>portYIELD_FROM_ISR()</code>)可立即允许高优先级任务执行。但是，如果存在已就绪的更高优先级任务，这将<strong class="font-semibold">不会</strong>允许低优先级任务运行。</li>
<li class="[&amp;:not(:first-child)]:mt-2">大多数函数不能在中断服务例程（ISRs）中调用。可在 ISRs 中使用的函数通常名称以“FromISR”结尾。</li>
<li class="[&amp;:not(:first-child)]:mt-2">ISRs 通常仅应用于复制数据并通知某个任务，由该任务执行实际处理。例如，如果您使用 <code>RAMN_CUSTOM_TIM6ISR</code>,它应仅用于通过 <code>vTaskNotifyGiveFromISR()</code> 通知另一个任务（请参阅 <code>HAL_UART_TxCpltCallback</code> 以获取示例）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">使用队列和流缓冲区在任务之间或任务与 ISRs 之间交换数据：<!-- -->
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">队列存储固定长度的数据项，并支持多个发送者和接收者。</li>
<li class="[&amp;:not(:first-child)]:mt-2">流缓冲区存储可变长度的数据项，但（默认情况下）仅支持一个发送方和一个接收方。</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">使用信号量实现互斥量。FreeRTOS 互斥量实现了优先级继承：如果一个低优先级任务获取了被高优先级任务请求的互斥量，则该低优先级任务的优先级将临时提升为高优先级，直到其释放该互斥量。你不能在中断服务例程中获取互斥量。</li>
<li class="[&amp;:not(:first-child)]:mt-2">队列、流缓冲区和信号量（以及其他同步原语）在使用前必须进行初始化，可通过静态或动态分配方式完成（例如：<code>xStreamBufferCreateStatic()</code>）。</li>
<li class="[&amp;:not(:first-child)]:mt-2">任务绝不能返回。如果你修改了 <code>RAMN_CUSTOM_CustomTask</code> 函数，请确保其中包含无限循环，或者以 <code>vTaskDelete(NULL)</code> 结束。</li>
<li class="[&amp;:not(:first-child)]:mt-2">使用 <code>osDelay()</code> 使任务进入睡眠状态，以便其他任务得以执行。如果你的任务执行时间可变，请使用 <code>vTaskDelayUntil()</code> 来计算相对于任务开始执行时刻的延迟时间（而非调用延迟函数时的时刻）。</li>
</ul>
<h2 id="局限性" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb"><a class="link_a7cea header-anchor link_a9ef4 inline-link_f855c" aria-hidden="true" href="#局限性">#</a>局限性</h2>
<p class="my-4 leading-7">RAMN 中没有内置方法来判断特定已排队待发送的 CAN 消息是否成功发送。默认情况下，CAN 外设的自动重传功能是启用的，这意味着 ECU 将持续重试发送，直到成功或进入总线关闭模式。</p>
<p class="my-4 leading-7">如果您禁用自动重传功能，请考虑修改 <code>RAMN_SendCANFunc()</code>、 <code>HAL_FDCAN_TxBufferCompleteCallback()</code> 以及 <code>HAL_FDCAN_ErrorCallback()</code>,以跟踪哪些报文已发送，哪些未发送。</p>
<p class="my-4 leading-7">请注意，当自动重传功能被禁用时，观察到的行为是： <strong class="font-semibold">如果 ECU 在仲裁过程中失败，将不会重新尝试传输</strong> （这是一种正常现象，并非真正的 CAN 错误）。您可能还需要修改源代码以改变这一行为。</p><!--/$--></div><div class="rspress-doc-footer"><footer class="mt-8"><div class="xs:flex pb-5 px-2 justify-end items-center"></div><div class="flex flex-col"></div><div class="flex flex-col sm:flex-row sm:justify-around gap-4 pt-6"><div class="prev_c92d1 flex flex-col"><a href="/docs/firmware.html" class="link_a7cea pager-link_e0d2d"><span class="desc_dcc01">Previous Page</span><span class="title_a3acb">固件</span></a></div><div class="next_c11be flex flex-col"><a href="/docs/firmware/architecture.html" class="link_a7cea pager-link_e0d2d next_ad355"><span class="desc_dcc01">Next Page</span><span class="title_a3acb">固件架构</span></a></div></div></footer></div></div><div class="aside-container_bc5fa"><div class="flex flex-col"><div id="aside-container" class="relative text-sm font-medium"><div class="leading-7 block text-sm font-semibold pl-3">目录</div><nav class="mt-1"><ul class="relative"><li><a href="#修改-ramn-固件" title="修改 RAMN 固件" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">修改 RAMN 固件</span></a></li><li><a href="#刷新-ramn-固件" title="刷新 RAMN 固件" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">刷新 RAMN 固件</span></a></li><li><a href="#调试-ramn-固件" title="调试 RAMN 固件" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">调试 RAMN 固件</span></a></li><li><a href="#配置固件ramn_configh" title="配置固件（ramn_config.h）" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">配置固件（ramn_config.h）</span></a></li><li><a href="#can-流量的简单修改标识符周期等" title="CAN 流量的简单修改（标识符、周期等）" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">CAN 流量的简单修改（标识符、周期等）</span></a></li><li><a href="#升级到-can-fd" title="升级到 CAN-FD" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">升级到 CAN-FD</span></a></li><li><a href="#can-流量的高级修改有效载荷格式等" title="CAN 流量的高级修改（有效载荷格式等）" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">CAN 流量的高级修改（有效载荷格式等）</span></a></li><li><a href="#修改-can-滤波器或波特率" title="修改 CAN 滤波器或波特率" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">修改 CAN 滤波器或波特率</span></a></li><li><a href="#修改-uds-接口" title="修改 UDS 接口" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">修改 UDS 接口</span></a></li><li><a href="#添加新内容" title="添加新内容" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">添加新内容</span></a></li><li><a href="#示例每秒发送一条-can-报文" title="示例：每秒发送一条 CAN 报文" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">示例：每秒发送一条 CAN 报文</span></a></li><li><a href="#示例在接收到特定-can-报文时执行某些操作" title="示例：在接收到特定 CAN 报文时执行某些操作" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">示例：在接收到特定 CAN 报文时执行某些操作</span></a></li><li><a href="#示例根据-ramn-控件做出决策" title="示例：根据 RAMN 控件做出决策" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">示例：根据 RAMN 控件做出决策</span></a></li><li><a href="#自定义-ecu-a-的显示" title="自定义 ECU A 的显示" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">自定义 ECU A 的显示</span></a></li><li><a href="#在闪存中保存数据" title="在闪存中保存数据" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">在闪存中保存数据</span></a></li><li><a href="#修改ioc-文件" title="修改.ioc 文件" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">修改.ioc 文件</span></a></li><li><a href="#系统与外设设置" title="系统与外设设置" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">系统与外设设置</span></a></li><li><a href="#freertos-设置" title="FreeRTOS 设置" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">FreeRTOS 设置</span></a></li><li><a href="#时钟设置" title="时钟设置" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">时钟设置</span></a></li><li><a href="#链接器设置" title="链接器设置" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">链接器设置</span></a></li><li><a href="#其他工具" title="其他工具" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">其他工具</span></a></li><li><a href="#优化性能" title="优化性能" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">优化性能</span></a></li><li><a href="#编译器优化" title="编译器优化" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">编译器优化</span></a></li><li><a href="#freertos-运行时统计信息" title="FreeRTOS 运行时统计信息" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">FreeRTOS 运行时统计信息</span></a></li><li><a href="#理解-ramn-的内存" title="理解 RAMN 的内存" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">理解 RAMN 的内存</span></a></li><li><a href="#理解-ramn-的安全特性" title="理解 RAMN 的安全特性" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">理解 RAMN 的安全特性</span></a></li><li><a href="#加固" title="加固" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">加固</span></a></li><li><a href="#内存保护" title="内存保护" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">内存保护</span></a></li><li><a href="#唯一硬件种子" title="唯一硬件种子" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">唯一硬件种子</span></a></li><li><a href="#额外的安全功能trustzone-等" title="额外的安全功能（TrustZone 等）" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">额外的安全功能（TrustZone 等）</span></a></li><li><a href="#探索-ramn-的安全性" title="探索 RAMN 的安全性" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">探索 RAMN 的安全性</span></a></li><li><a href="#在-ghidra-中分析-ramn-固件" title="在 Ghidra 中分析 RAMN 固件" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">在 Ghidra 中分析 RAMN 固件</span></a></li><li><a href="#为-ramn-编写-arm-shellcode" title="为 RAMN 编写 ARM shellcode" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">为 RAMN 编写 ARM shellcode</span></a></li><li><a href="#使用-openocd-进行调试" title="使用 OpenOCD 进行调试" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">使用 OpenOCD 进行调试</span></a></li><li><a href="#典型项目指导" title="典型项目指导" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">典型项目指导</span></a></li><li><a href="#为ctf或类似活动准备-ramn" title="为CTF（或类似活动）准备 RAMN" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">为CTF（或类似活动）准备 RAMN</span></a></li><li><a href="#实现安全的-can-总线secoc-等" title="实现安全的 CAN 总线（SecOC 等）" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">实现安全的 CAN 总线（SecOC 等）</span></a></li><li><a href="#实现自定义引导程序ota安全启动等" title="实现自定义引导程序（OTA、安全启动等）" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">实现自定义引导程序（OTA、安全启动等）</span></a></li><li><a href="#实现漏洞" title="实现漏洞" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">实现漏洞</span></a></li><li><a href="#创建新扩展" title="创建新扩展" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">创建新扩展</span></a></li><li><a href="#uart" title="UART" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">UART</span></a></li><li><a href="#i2c" title="I2C" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">I2C</span></a></li><li><a href="#spi" title="SPI" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">SPI</span></a></li><li><a href="#模数转换器adc" title="模数转换器（ADC）" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">模数转换器（ADC）</span></a></li><li><a href="#定时器pwm" title="定时器（PWM）" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">定时器（PWM）</span></a></li><li><a href="#gpio-与中断" title="GPIO 与中断" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:24px;font-weight:semibold"><span class="aside-link-text block">GPIO 与中断</span></a></li><li><a href="#freertos-通用提示" title="FreeRTOS 通用提示" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">FreeRTOS 通用提示</span></a></li><li><a href="#局限性" title="局限性" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">局限性</span></a></li></ul></nav></div></div></div></div></div></div></section></div>
    <div id="search-container"></div>
  </body>
</html>
